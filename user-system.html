<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹ - ç”¨æˆ¶ç³»çµ± v0.8</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .user-avatar {
      @apply w-12 h-12 rounded-full bg-gradient-to-br from-indigo-400 to-purple-600 flex items-center justify-center text-white font-bold;
    }
    .card-hover {
      @apply hover:shadow-xl transition-shadow duration-300 cursor-pointer;
    }
    .status-indicator {
      @apply w-3 h-3 rounded-full inline-block;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app"></div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun@0.2020.x/gun.js"></script>
  
  <script type="module">
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue

    // å°å…¥å¿…éœ€æ¨¡å¡Š
    const modules = await Promise.all([
      import('./js/storage.js'),
      import('./js/bot-engine.js'),
      import('./js/notifications.js'),
      import('./js/task-model.js'),
      import('./js/advanced-search.js'),
      import('./js/cache-manager.js'),
      import('./js/performance-optimization.js')
    ])

    const { initGUN, loginAnonymous, getCurrentUser, logout } = modules[0]
    const { createBotEngine } = modules[1]
    const { createNotificationSystem } = modules[2]
    const { createDefaultTask } = modules[3]
    const { advancedSearch } = modules[4]
    const { createCacheManager } = modules[5]
    const { debounce } = modules[6]

    // å»ºç«‹ç³»çµ±å¯¦ä¾‹
    const botEngine = createBotEngine()
    const notificationSystem = createNotificationSystem()
    const cacheManager = createCacheManager(60000)

    // å»ºç«‹æ‡‰ç”¨
    const app = createApp({
      template: `
        <div class="min-h-screen bg-gray-50">
          <!-- é ‚éƒ¨å°èˆª -->
          <nav class="bg-white shadow-md sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
              <div class="flex items-center gap-3">
                <div class="text-3xl">ğŸ«</div>
                <div>
                  <h1 class="text-xl font-bold text-gray-800">æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹</h1>
                  <p class="text-xs text-gray-500">ç”¨æˆ¶ç³»çµ± v0.8</p>
                </div>
              </div>
              
              <div class="flex items-center gap-4" v-if="isLoggedIn">
                <div class="hidden md:flex items-center gap-3">
                  <span class="text-sm text-gray-600">{{ userInfo.username }}</span>
                  <div class="user-avatar">{{ userInfo.username.charAt(0).toUpperCase() }}</div>
                </div>
                <button @click="showUserMenu = !showUserMenu" class="md:hidden">
                  <div class="user-avatar text-lg">â‹®</div>
                </button>
                <div v-if="showUserMenu" class="absolute top-16 right-4 bg-white shadow-lg rounded-lg overflow-hidden z-50">
                  <button @click="currentPage = 'profile'" class="block w-full text-left px-4 py-2 hover:bg-gray-100">
                    ğŸ‘¤ å€‹äººè³‡æ–™
                  </button>
                  <button @click="currentPage = 'settings'" class="block w-full text-left px-4 py-2 hover:bg-gray-100">
                    âš™ï¸ è¨­ç½®
                  </button>
                  <button @click="handleLogout" class="block w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600">
                    ğŸšª ç™»å‡º
                  </button>
                </div>
              </div>
            </div>
          </nav>

          <!-- æœªç™»å…¥ç•«é¢ -->
          <div v-if="!isLoggedIn" class="min-h-screen flex items-center justify-center">
            <div class="w-full max-w-md">
              <!-- ç™»å…¥é¢æ¿ -->
              <div v-if="!showRegister" class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="text-center mb-8">
                  <div class="text-6xl mb-4">ğŸ«</div>
                  <h2 class="text-3xl font-bold text-gray-800 mb-2">æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹</h2>
                  <p class="text-gray-600">è‡ªå‹•åŒ–æ¶ç¥¨ Â· å¯¦æ™‚é€šçŸ¥ Â· å¤šè¨­å‚™åŒæ­¥</p>
                </div>

                <form @submit.prevent="handleLogin" class="space-y-4">
                  <div>
                    <label class="block text-sm font-semibold mb-2">ç”¨æˆ¶å</label>
                    <input 
                      v-model="loginForm.username" 
                      type="text" 
                      placeholder="è¼¸å…¥ç”¨æˆ¶å"
                      class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      required>
                  </div>
                  <div>
                    <label class="block text-sm font-semibold mb-2">å¯†ç¢¼</label>
                    <input 
                      v-model="loginForm.password" 
                      type="password" 
                      placeholder="è¼¸å…¥å¯†ç¢¼"
                      class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      required>
                  </div>

                  <div v-if="loginError" class="bg-red-100 text-red-700 px-4 py-3 rounded-lg text-sm">
                    {{ loginError }}
                  </div>

                  <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                    ğŸš€ ç™»å…¥
                  </button>
                </form>

                <p class="text-center text-sm text-gray-600 mt-6">
                  æ²’æœ‰å¸³è™Ÿï¼Ÿ
                  <button @click="showRegister = true" class="text-indigo-600 font-semibold hover:text-indigo-700">
                    è¨»å†Šæ–°å¸³è™Ÿ
                  </button>
                </p>

                <div class="mt-6 pt-6 border-t">
                  <p class="text-xs text-gray-500 text-center mb-3">æˆ–ä½¿ç”¨æ¸¬è©¦å¸³è™Ÿç™»å…¥</p>
                  <button @click="quickLogin('user1')" class="w-full bg-gray-100 text-gray-700 py-2 rounded-lg hover:bg-gray-200 transition text-sm mb-2">
                    ğŸ‘¤ user1
                  </button>
                  <button @click="quickLogin('user2')" class="w-full bg-gray-100 text-gray-700 py-2 rounded-lg hover:bg-gray-200 transition text-sm">
                    ğŸ‘¥ user2
                  </button>
                </div>
              </div>

              <!-- è¨»å†Šé¢æ¿ -->
              <div v-else class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="text-center mb-8">
                  <h2 class="text-3xl font-bold text-gray-800 mb-2">å»ºç«‹æ–°å¸³è™Ÿ</h2>
                  <p class="text-gray-600">é–‹å§‹ä½¿ç”¨æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹</p>
                </div>

                <form @submit.prevent="handleRegister" class="space-y-4">
                  <div>
                    <label class="block text-sm font-semibold mb-2">ç”¨æˆ¶å</label>
                    <input 
                      v-model="registerForm.username" 
                      type="text" 
                      placeholder="è¼¸å…¥ç”¨æˆ¶å"
                      class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      required>
                  </div>
                  <div>
                    <label class="block text-sm font-semibold mb-2">é›»éƒµ</label>
                    <input 
                      v-model="registerForm.email" 
                      type="email" 
                      placeholder="è¼¸å…¥é›»éƒµ"
                      class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      required>
                  </div>
                  <div>
                    <label class="block text-sm font-semibold mb-2">å¯†ç¢¼</label>
                    <input 
                      v-model="registerForm.password" 
                      type="password" 
                      placeholder="è¼¸å…¥å¯†ç¢¼ï¼ˆè‡³å°‘6ä½ï¼‰"
                      class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      minlength="6"
                      required>
                  </div>
                  <div>
                    <label class="block text-sm font-semibold mb-2">ç¢ºèªå¯†ç¢¼</label>
                    <input 
                      v-model="registerForm.confirmPassword" 
                      type="password" 
                      placeholder="ç¢ºèªå¯†ç¢¼"
                      class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      required>
                  </div>

                  <div v-if="registerError" class="bg-red-100 text-red-700 px-4 py-3 rounded-lg text-sm">
                    {{ registerError }}
                  </div>

                  <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                    âœ“ å»ºç«‹å¸³è™Ÿ
                  </button>
                </form>

                <p class="text-center text-sm text-gray-600 mt-6">
                  å·²æœ‰å¸³è™Ÿï¼Ÿ
                  <button @click="showRegister = false" class="text-indigo-600 font-semibold hover:text-indigo-700">
                    è¿”å›ç™»å…¥
                  </button>
                </p>
              </div>
            </div>
          </div>

          <!-- å·²ç™»å…¥ä¸»ä»‹é¢ -->
          <div v-else class="max-w-7xl mx-auto px-4 py-6">
            <!-- æ¨™ç±¤å°èˆª -->
            <div class="bg-white rounded-lg shadow-sm p-1 inline-flex gap-1 mb-6 flex-wrap">
              <button 
                v-for="tab in tabs" :key="tab"
                @click="currentPage = tab"
                :class="['px-4 py-2 rounded-md text-sm font-medium transition',
                         currentPage === tab ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-100']">
                {{ tabIcons[tab] }} {{ tab }}
              </button>
            </div>

            <!-- ä¸»é  -->
            <div v-if="currentPage === 'ä¸»é '" class="space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-lg">
                  <div class="text-3xl mb-2">ğŸ“Š</div>
                  <p class="text-blue-100">ç¸½ä»»å‹™æ•¸</p>
                  <p class="text-4xl font-bold mt-2">{{ stats.total }}</p>
                </div>
                <div class="card bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-lg">
                  <div class="text-3xl mb-2">âœ…</div>
                  <p class="text-green-100">æˆåŠŸä»»å‹™</p>
                  <p class="text-4xl font-bold mt-2">{{ stats.success }}</p>
                </div>
                <div class="card bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-lg">
                  <div class="text-3xl mb-2">ğŸ“ˆ</div>
                  <p class="text-purple-100">æˆåŠŸç‡</p>
                  <p class="text-4xl font-bold mt-2">{{ stats.rate }}%</p>
                </div>
              </div>

              <!-- å¿«é€Ÿæ“ä½œ -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button @click="currentPage = 'ä»»å‹™'" class="card-hover bg-white p-6 rounded-lg shadow">
                  <div class="text-4xl mb-3">ğŸ“‹</div>
                  <h3 class="font-bold text-lg mb-1">æˆ‘çš„ä»»å‹™</h3>
                  <p class="text-gray-600 text-sm">ç®¡ç†å’Œè¿½è¹¤æ‰€æœ‰æ¶ç¥¨ä»»å‹™</p>
                </button>
                <button @click="currentPage = 'å€‹äººè³‡æ–™'" class="card-hover bg-white p-6 rounded-lg shadow">
                  <div class="text-4xl mb-3">ğŸ‘¤</div>
                  <h3 class="font-bold text-lg mb-1">å€‹äººè³‡æ–™</h3>
                  <p class="text-gray-600 text-sm">ç·¨è¼¯å¸³è™Ÿå’Œå€‹äººä¿¡æ¯</p>
                </button>
              </div>

              <!-- æœ€è¿‘æ´»å‹• -->
              <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">æœ€è¿‘æ´»å‹•</h2>
                <div class="space-y-3">
                  <div v-for="(activity, idx) in recentActivities.slice(0, 5)" :key="idx" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div>
                      <p class="font-semibold text-gray-800">{{ activity.title }}</p>
                      <p class="text-sm text-gray-600">{{ activity.time }}</p>
                    </div>
                    <span class="text-xl">{{ activity.icon }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- ä»»å‹™é  -->
            <div v-if="currentPage === 'ä»»å‹™'" class="space-y-4">
              <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">æˆ‘çš„ä»»å‹™</h2>
                <button @click="showTaskForm = true" class="btn-primary">â• æ–°å¢ä»»å‹™</button>
              </div>

              <!-- æœå°‹å’Œç¯©é¸ -->
              <div class="bg-white rounded-lg shadow p-4 space-y-3">
                <input 
                  v-model="taskSearch"
                  @input="searchTasks"
                  type="text"
                  placeholder="ğŸ” æœå°‹ä»»å‹™..."
                  class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                
                <select v-model="taskFilter" @change="applyFilter" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                  <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                  <option value="pending">å¾…æ©Ÿ</option>
                  <option value="running">é‹è¡Œä¸­</option>
                  <option value="success">æˆåŠŸ</option>
                  <option value="failed">å¤±æ•—</option>
                </select>
              </div>

              <!-- ä»»å‹™åˆ—è¡¨ -->
              <div v-if="filteredTasks.length === 0" class="bg-white rounded-lg shadow p-12 text-center">
                <p class="text-4xl mb-3">ğŸ“</p>
                <p class="text-gray-600 mb-4">æš«ç„¡ä»»å‹™</p>
                <button @click="showTaskForm = true" class="btn-primary">å‰µå»ºç¬¬ä¸€å€‹ä»»å‹™</button>
              </div>

              <div v-else class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div v-for="task in filteredTasks" :key="task.id" class="bg-white rounded-lg shadow-md p-5 hover:shadow-lg transition">
                  <div class="flex justify-between items-start mb-3">
                    <div>
                      <h3 class="font-bold text-lg text-gray-800">{{ task.eventName }}</h3>
                      <p class="text-sm text-gray-600">{{ task.name }}</p>
                    </div>
                    <span :class="['px-3 py-1 rounded-full text-xs font-semibold',
                      task.status === 'success' ? 'bg-green-100 text-green-700' :
                      task.status === 'failed' ? 'bg-red-100 text-red-700' :
                      task.status === 'running' ? 'bg-blue-100 text-blue-700' :
                      'bg-gray-100 text-gray-700']">
                      {{ statusText(task.status) }}
                    </span>
                  </div>

                  <div class="text-sm text-gray-600 space-y-1 mb-4">
                    <div>ğŸ“… {{ task.eventDate }}</div>
                    <div>â° {{ task.startTime }}</div>
                    <div>â­ {{ task.priority }}/10 å„ªå…ˆç´š</div>
                  </div>

                  <div class="flex gap-2 pt-3 border-t">
                    <button v-if="task.status === 'pending'" 
                            @click="startTask(task.id)"
                            class="btn-sm bg-green-600 text-white hover:bg-green-700 flex-1">
                      â–¶ é–‹å§‹
                    </button>
                    <button v-if="task.status === 'running'" 
                            @click="pauseTask(task.id)"
                            class="btn-sm bg-yellow-600 text-white hover:bg-yellow-700 flex-1">
                      â¸ æš«åœ
                    </button>
                    <button @click="deleteTask(task.id)" class="btn-sm bg-red-600 text-white hover:bg-red-700">
                      ğŸ—‘
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- å€‹äººè³‡æ–™é  -->
            <div v-if="currentPage === 'å€‹äººè³‡æ–™'" class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- ç”¨æˆ¶ä¿¡æ¯å¡ -->
              <div class="md:col-span-1">
                <div class="bg-white rounded-lg shadow p-6 text-center">
                  <div class="user-avatar text-4xl mx-auto mb-4">{{ userInfo.username.charAt(0).toUpperCase() }}</div>
                  <h2 class="text-2xl font-bold text-gray-800">{{ userInfo.username }}</h2>
                  <p class="text-gray-600 mt-1">{{ userInfo.email }}</p>
                  <div class="mt-4 pt-4 border-t text-sm text-gray-600 space-y-2">
                    <div>åŠ å…¥æ™‚é–“: {{ formatDate(userInfo.joinDate) }}</div>
                    <div>å¸³è™Ÿç­‰ç´š: <span class="font-semibold text-indigo-600">{{ userInfo.tier }}</span></div>
                    <div>é€£çºŒç™»å…¥: <span class="font-semibold">{{ userInfo.streakDays }} å¤©</span></div>
                  </div>
                </div>
              </div>

              <!-- ç”¨æˆ¶è©³ç´°ä¿¡æ¯ -->
              <div class="md:col-span-2 space-y-6">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="bg-white rounded-lg shadow p-6">
                  <h3 class="text-lg font-bold mb-4">åŸºæœ¬ä¿¡æ¯</h3>
                  <div class="space-y-4">
                    <div>
                      <label class="block text-sm font-semibold mb-1">ç”¨æˆ¶å</label>
                      <input v-model="userInfo.username" type="text" disabled class="w-full px-4 py-2 border rounded-lg bg-gray-50">
                    </div>
                    <div>
                      <label class="block text-sm font-semibold mb-1">é›»éƒµ</label>
                      <input v-model="userInfo.email" type="email" disabled class="w-full px-4 py-2 border rounded-lg bg-gray-50">
                    </div>
                    <div>
                      <label class="block text-sm font-semibold mb-1">æ‰‹æ©Ÿè™Ÿç¢¼</label>
                      <input v-model="userInfo.phone" type="tel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                    <div>
                      <label class="block text-sm font-semibold mb-1">åœ°å€</label>
                      <select v-model="userInfo.region" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">é¸æ“‡åœ°å€</option>
                        <option value="å°ç£">å°ç£</option>
                        <option value="é¦™æ¸¯">é¦™æ¸¯</option>
                        <option value="ä¸­åœ‹">ä¸­åœ‹</option>
                        <option value="æ–°åŠ å¡">æ–°åŠ å¡</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                      </select>
                    </div>
                  </div>
                </div>

                <!-- å¸³è™Ÿçµ±è¨ˆ -->
                <div class="bg-white rounded-lg shadow p-6">
                  <h3 class="text-lg font-bold mb-4">å¸³è™Ÿçµ±è¨ˆ</h3>
                  <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-3 bg-indigo-50 rounded-lg">
                      <p class="text-2xl font-bold text-indigo-600">{{ stats.total }}</p>
                      <p class="text-xs text-gray-600">ç¸½ä»»å‹™</p>
                    </div>
                    <div class="text-center p-3 bg-green-50 rounded-lg">
                      <p class="text-2xl font-bold text-green-600">{{ stats.success }}</p>
                      <p class="text-xs text-gray-600">æˆåŠŸ</p>
                    </div>
                    <div class="text-center p-3 bg-red-50 rounded-lg">
                      <p class="text-2xl font-bold text-red-600">{{ stats.failed }}</p>
                      <p class="text-xs text-gray-600">å¤±æ•—</p>
                    </div>
                  </div>
                </div>

                <!-- å®‰å…¨è¨­ç½® -->
                <div class="bg-white rounded-lg shadow p-6">
                  <h3 class="text-lg font-bold mb-4">å®‰å…¨è¨­ç½®</h3>
                  <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div>
                        <p class="font-semibold">ä¿®æ”¹å¯†ç¢¼</p>
                        <p class="text-sm text-gray-600">ä¸Šæ¬¡ä¿®æ”¹: 30 å¤©å‰</p>
                      </div>
                      <button class="btn-secondary text-sm">ä¿®æ”¹</button>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div>
                        <p class="font-semibold">é›™é‡èªè­‰</p>
                        <p class="text-sm text-gray-600">æœªå•Ÿç”¨</p>
                      </div>
                      <button class="btn-secondary text-sm">å•Ÿç”¨</button>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div>
                        <p class="font-semibold">ç™»å…¥æ­·å²</p>
                        <p class="text-sm text-gray-600">æŸ¥çœ‹å¸³è™Ÿæ´»å‹•</p>
                      </div>
                      <button class="text-indigo-600 hover:text-indigo-700 font-semibold text-sm">æŸ¥çœ‹</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- è¨­ç½®é  -->
            <div v-if="currentPage === 'è¨­ç½®'" class="space-y-6">
              <!-- é€šçŸ¥è¨­ç½® -->
              <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-bold mb-4">é€šçŸ¥è¨­ç½®</h3>
                <div class="space-y-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="font-semibold">æ¡Œé¢é€šçŸ¥</p>
                      <p class="text-sm text-gray-600">ä»»å‹™ç‹€æ…‹æ›´æ–°é€šçŸ¥</p>
                    </div>
                    <label class="flex items-center cursor-pointer">
                      <input v-model="settings.notificationEnabled" type="checkbox" class="rounded">
                    </label>
                  </div>
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="font-semibold">éƒµä»¶é€šçŸ¥</p>
                      <p class="text-sm text-gray-600">æ¥æ”¶é‡è¦æ›´æ–°</p>
                    </div>
                    <label class="flex items-center cursor-pointer">
                      <input v-model="settings.emailNotification" type="checkbox" class="rounded">
                    </label>
                  </div>
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="font-semibold">æ¨é€é€šçŸ¥</p>
                      <p class="text-sm text-gray-600">ç§»å‹•è¨­å‚™æ¨é€</p>
                    </div>
                    <label class="flex items-center cursor-pointer">
                      <input v-model="settings.pushNotification" type="checkbox" class="rounded">
                    </label>
                  </div>
                </div>
              </div>

              <!-- éš±ç§è¨­ç½® -->
              <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-bold mb-4">éš±ç§èˆ‡æ•¸æ“š</h3>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-semibold mb-2">å¸³è™Ÿéš±ç§</label>
                    <select v-model="settings.privacy" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                      <option value="public">å…¬é–‹</option>
                      <option value="friends">æœ‹å‹åª</option>
                      <option value="private">ç§å¯†</option>
                    </select>
                  </div>
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div>
                      <p class="font-semibold">æ•¸æ“šåˆ†æ</p>
                      <p class="text-sm text-gray-600">å¹«åŠ©æ”¹é€²æ‡‰ç”¨é«”é©—</p>
                    </div>
                    <label class="flex items-center cursor-pointer">
                      <input v-model="settings.analytics" type="checkbox" class="rounded">
                    </label>
                  </div>
                </div>
              </div>

              <!-- ä¸»é¡Œè¨­ç½® -->
              <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-bold mb-4">å¤–è§€è¨­ç½®</h3>
                <div>
                  <label class="block text-sm font-semibold mb-2">ä¸»é¡Œ</label>
                  <select v-model="settings.theme" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    <option value="light">æ·ºè‰²</option>
                    <option value="dark">æ·±è‰²</option>
                    <option value="auto">è‡ªå‹•</option>
                  </select>
                </div>
              </div>

              <!-- æ•¸æ“šç®¡ç† -->
              <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-bold mb-4">æ•¸æ“šç®¡ç†</h3>
                <div class="space-y-3">
                  <button @click="exportUserData" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                    ğŸ“¥ å°å‡ºæˆ‘çš„æ•¸æ“š
                  </button>
                  <button @click="clearCache" class="w-full bg-yellow-600 text-white py-2 rounded-lg hover:bg-yellow-700 transition">
                    ğŸ§¹ æ¸…é™¤å¿«å–
                  </button>
                  <button @click="deleteAccount" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition">
                    ğŸ—‘ï¸ åˆªé™¤å¸³è™Ÿ
                  </button>
                </div>
              </div>

              <!-- é—œæ–¼æ‡‰ç”¨ -->
              <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-bold mb-4">é—œæ–¼æ‡‰ç”¨</h3>
                <div class="text-sm text-gray-600 space-y-2">
                  <div class="flex justify-between">
                    <span>ç‰ˆæœ¬</span>
                    <span class="font-semibold">v0.8 - User System</span>
                  </div>
                  <div class="flex justify-between">
                    <span>é–‹ç™¼éšæ®µ</span>
                    <span class="font-semibold">Stage 6+</span>
                  </div>
                  <div class="flex justify-between">
                    <span>æœ€å¾Œæ›´æ–°</span>
                    <span class="font-semibold">2025-12-24</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ä»»å‹™è¡¨å–®å½ˆçª— -->
          <div v-if="showTaskForm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
              <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold">å‰µå»ºæ–°ä»»å‹™</h2>
                  <button @click="showTaskForm = false" class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <form @submit.prevent="saveTask" class="space-y-4">
                  <div>
                    <label class="block text-sm font-semibold mb-1">ä»»å‹™åç¨±</label>
                    <input v-model="newTask.name" type="text" required
                           class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                  </div>
                  <div>
                    <label class="block text-sm font-semibold mb-1">æ´»å‹•åç¨±</label>
                    <input v-model="newTask.eventName" type="text" required
                           class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                  </div>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-semibold mb-1">æ´»å‹•æ—¥æœŸ</label>
                      <input v-model="newTask.eventDate" type="date" required
                             class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                    <div>
                      <label class="block text-sm font-semibold mb-1">é–‹æ¶æ™‚é–“</label>
                      <input v-model="newTask.startTime" type="datetime-local" required
                             class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-semibold mb-1">è³¼ç¥¨æ•¸é‡</label>
                      <input v-model.number="newTask.ticketQuantity" type="number" min="1" max="10" required
                             class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                    <div>
                      <label class="block text-sm font-semibold mb-1">å„ªå…ˆç´š (1-10)</label>
                      <input v-model.number="newTask.priority" type="number" min="1" max="10"
                             class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                  </div>
                  <div class="flex gap-3 pt-4">
                    <button type="submit" class="btn-primary flex-1">å‰µå»ºä»»å‹™</button>
                    <button type="button" @click="showTaskForm = false" class="btn-secondary flex-1">å–æ¶ˆ</button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- é€šçŸ¥ -->
          <div v-if="notification.show" 
               :class="['fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 fade-in',
                        notification.type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700']">
            <div class="flex justify-between items-start">
              <p>{{ notification.message }}</p>
              <button @click="notification.show = false" class="ml-4 text-lg">&times;</button>
            </div>
          </div>
        </div>
      `,

      setup() {
        const isLoggedIn = ref(false)
        const showRegister = ref(false)
        const showUserMenu = ref(false)
        const showTaskForm = ref(false)
        const currentPage = ref('ä¸»é ')
        const tasks = ref([])
        const filteredTasks = ref([])
        const taskSearch = ref('')
        const taskFilter = ref('')
        const notification = reactive({ show: false, type: 'success', message: '' })
        const loginError = ref('')
        const registerError = ref('')

        const loginForm = reactive({ username: '', password: '' })
        const registerForm = reactive({ 
          username: '', 
          email: '', 
          password: '', 
          confirmPassword: '' 
        })

        const newTask = reactive({
          name: '',
          eventName: '',
          eventDate: '',
          startTime: '',
          ticketQuantity: 1,
          priority: 5
        })

        const userInfo = reactive({
          username: '',
          email: '',
          phone: '',
          region: '',
          joinDate: new Date(),
          tier: 'æ¨™æº–',
          streakDays: 5
        })

        const settings = reactive({
          notificationEnabled: true,
          emailNotification: false,
          pushNotification: true,
          privacy: 'private',
          analytics: true,
          theme: 'light'
        })

        const recentActivities = ref([
          { icon: 'âœ…', title: 'å®Œæˆä»»å‹™', time: '2å°æ™‚å‰' },
          { icon: 'ğŸ«', title: 'å‰µå»ºæ–°ä»»å‹™', time: '1å¤©å‰' },
          { icon: 'ğŸ“Š', title: 'æŸ¥çœ‹çµ±è¨ˆ', time: '3å¤©å‰' },
          { icon: 'âš™ï¸', title: 'æ›´æ–°è¨­ç½®', time: '5å¤©å‰' },
          { icon: 'ğŸ””', title: 'æ”¶åˆ°é€šçŸ¥', time: '1é€±å‰' }
        ])

        const tabs = ['ä¸»é ', 'ä»»å‹™', 'å€‹äººè³‡æ–™', 'è¨­ç½®']
        const tabIcons = {
          'ä¸»é ': 'ğŸ ',
          'ä»»å‹™': 'ğŸ“‹',
          'å€‹äººè³‡æ–™': 'ğŸ‘¤',
          'è¨­ç½®': 'âš™ï¸'
        }

        const stats = computed(() => ({
          total: tasks.value.length,
          success: tasks.value.filter(t => t.status === 'success').length,
          failed: tasks.value.filter(t => t.status === 'failed').length,
          rate: tasks.value.length ? Math.round((tasks.value.filter(t => t.status === 'success').length / tasks.value.length) * 100) : 0
        }))

        const notify = (msg, type = 'success') => {
          notification.show = true
          notification.type = type
          notification.message = msg
          setTimeout(() => notification.show = false, 3000)
        }

        const statusText = (status) => {
          const map = {
            'pending': 'å¾…æ©Ÿ',
            'running': 'é‹è¡Œä¸­',
            'success': 'æˆåŠŸ',
            'failed': 'å¤±æ•—',
            'paused': 'å·²æš«åœ'
          }
          return map[status] || status
        }

        const formatDate = (date) => {
          return new Date(date).toLocaleDateString('zh-TW')
        }

        const handleLogin = async () => {
          try {
            if (!loginForm.username || !loginForm.password) {
              loginError.value = 'è«‹è¼¸å…¥ç”¨æˆ¶åå’Œå¯†ç¢¼'
              return
            }
            
            await loginAnonymous()
            userInfo.username = loginForm.username
            userInfo.email = `${loginForm.username}@ticketbot.com`
            isLoggedIn.value = true
            loginError.value = ''
            await loadTasks()
            notify('ç™»å…¥æˆåŠŸï¼')
          } catch (e) {
            loginError.value = e.message
          }
        }

        const handleRegister = async () => {
          try {
            if (!registerForm.username || !registerForm.email || !registerForm.password) {
              registerError.value = 'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½'
              return
            }
            
            if (registerForm.password !== registerForm.confirmPassword) {
              registerError.value = 'å…©æ¬¡å¯†ç¢¼ä¸ç¬¦'
              return
            }

            if (registerForm.password.length < 6) {
              registerError.value = 'å¯†ç¢¼è‡³å°‘6å€‹å­—ç¬¦'
              return
            }

            await loginAnonymous()
            userInfo.username = registerForm.username
            userInfo.email = registerForm.email
            isLoggedIn.value = true
            showRegister.value = false
            registerError.value = ''
            notify('å¸³è™Ÿå‰µå»ºæˆåŠŸï¼')
          } catch (e) {
            registerError.value = e.message
          }
        }

        const quickLogin = async (username) => {
          loginForm.username = username
          loginForm.password = 'password'
          await handleLogin()
        }

        const handleLogout = () => {
          isLoggedIn.value = false
          tasks.value = []
          filteredTasks.value = []
          loginForm.username = ''
          loginForm.password = ''
          notify('å·²ç™»å‡º')
        }

        const loadTasks = async () => {
          tasks.value = await botEngine.listTasks()
          filteredTasks.value = tasks.value
        }

        const searchTasks = debounce(() => {
          applyFilter()
        }, 300)

        const applyFilter = () => {
          let filtered = tasks.value

          if (taskFilter.value) {
            filtered = filtered.filter(t => t.status === taskFilter.value)
          }

          if (taskSearch.value) {
            filtered = advancedSearch(filtered, taskSearch.value, {
              searchFields: ['name', 'eventName'],
              matchMode: 'contains'
            })
          }

          filteredTasks.value = filtered
        }

        const saveTask = async () => {
          try {
            const task = createDefaultTask({
              name: newTask.name,
              eventName: newTask.eventName,
              eventDate: newTask.eventDate,
              startTime: newTask.startTime,
              ticketQuantity: newTask.ticketQuantity,
              priority: newTask.priority,
              config: {
                targetUrl: '',
                clickSelector: '.buy-button',
                clickDelay: 500,
                retryCount: 3
              }
            })
            
            await botEngine.addTask(task)
            await loadTasks()
            showTaskForm.value = false
            
            // é‡ç½®è¡¨å–®
            Object.assign(newTask, {
              name: '', eventName: '', eventDate: '', startTime: '',
              ticketQuantity: 1, priority: 5
            })
            
            notify('ä»»å‹™å‰µå»ºæˆåŠŸï¼')
          } catch (e) {
            notify(e.message, 'error')
          }
        }

        const startTask = async (id) => {
          try {
            await botEngine.startTask(id)
            await loadTasks()
            notify('ä»»å‹™å·²é–‹å§‹åŸ·è¡Œ')
          } catch (e) {
            notify(e.message, 'error')
          }
        }

        const pauseTask = async (id) => {
          try {
            await botEngine.pauseTask(id)
            await loadTasks()
            notify('ä»»å‹™å·²æš«åœ')
          } catch (e) {
            notify(e.message, 'error')
          }
        }

        const deleteTask = async (id) => {
          if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ä»»å‹™å—ï¼Ÿ')) return
          try {
            await botEngine.deleteTask(id)
            await loadTasks()
            notify('ä»»å‹™å·²åˆªé™¤')
          } catch (e) {
            notify(e.message, 'error')
          }
        }

        const exportUserData = () => {
          const data = {
            userInfo,
            tasks: tasks.value,
            settings,
            exportDate: new Date().toISOString()
          }
          
          const json = JSON.stringify(data, null, 2)
          const blob = new Blob([json], { type: 'application/json' })
          const url = URL.createObjectURL(blob)
          const a = document.createElement('a')
          a.href = url
          a.download = `user-data-${new Date().toISOString().slice(0, 10)}.json`
          a.click()
          notify('æ•¸æ“šå·²å°å‡º')
        }

        const clearCache = () => {
          cacheManager.clear()
          notify('å¿«å–å·²æ¸…é™¤')
        }

        const deleteAccount = () => {
          if (!confirm('æ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ï¼Œç¢ºå®šè¦åˆªé™¤å¸³è™Ÿå—ï¼Ÿ')) return
          
          isLoggedIn.value = false
          tasks.value = []
          filteredTasks.value = []
          notify('å¸³è™Ÿå·²åˆªé™¤')
        }

        onMounted(async () => {
          try {
            await initGUN()
            const user = getCurrentUser()
            if (user) {
              isLoggedIn.value = true
              await loadTasks()
            }
          } catch (e) {
            console.error(e)
          }
        })

        return {
          isLoggedIn, showRegister, showUserMenu, showTaskForm, currentPage,
          tasks, filteredTasks, taskSearch, taskFilter, notification,
          loginForm, registerForm, newTask, userInfo, settings, recentActivities,
          tabs, tabIcons, stats, loginError, registerError,
          handleLogin, handleRegister, quickLogin, handleLogout,
          loadTasks, searchTasks, applyFilter, saveTask,
          startTask, pauseTask, deleteTask,
          exportUserData, clearCache, deleteAccount,
          notify, statusText, formatDate
        }
      }
    })

    app.mount('#app')
  </script>
</body>
</html>
