<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹ - å¾Œå°ç®¡ç†ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .sidebar-link {
      @apply flex items-center px-4 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors cursor-pointer rounded-lg;
    }
    .sidebar-link.active {
      @apply bg-indigo-100 text-indigo-700 font-medium;
    }
    .stat-card {
      @apply bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow;
    }
    .table-row {
      @apply hover:bg-gray-50 transition-colors;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="app"></div>

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  
  <!-- GUN.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/gun@0.2020.x/gun.js"></script>
  
  <!-- å¾Œå°ç®¡ç†ç³»çµ± -->
  <script type="module">
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue

    // å°å…¥æ¨¡å¡Š
    const modules = await Promise.all([
      import('./js/storage.js'),
      import('./js/bot-engine.js'),
      import('./js/automation-engine.js'),
      import('./js/notifications.js'),
      import('./js/admin.js')
    ])

    const { initGUN, loginAnonymous, getCurrentUser, logout } = modules[0]
    const { createBotEngine } = modules[1]
    const { createAutomationEngine } = modules[2]
    const { createNotificationSystem } = modules[3]
    const { createAdminSystem } = modules[4]

    // å‰µå»ºç³»çµ±å¯¦ä¾‹
    const botEngine = createBotEngine()
    const automationEngine = createAutomationEngine()
    const notificationSystem = createNotificationSystem()
    const adminSystem = createAdminSystem(botEngine, automationEngine)

    // å‰µå»º Vue æ‡‰ç”¨
    const app = createApp({
      template: `
        <div v-if="!isAdminLoggedIn" class="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
          <!-- ç®¡ç†å“¡ç™»å…¥ç•Œé¢ -->
          <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
              <div class="text-6xl mb-4">ğŸ”</div>
              <h2 class="text-3xl font-bold text-gray-800 mb-2">å¾Œå°ç®¡ç†ç³»çµ±</h2>
              <p class="text-gray-600">è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼</p>
            </div>
            
            <div v-if="loginError" class="bg-red-100 text-red-700 px-4 py-3 rounded-lg mb-4">
              {{ loginError }}
            </div>
            
            <form @submit.prevent="handleAdminLogin" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ç®¡ç†å“¡å¸³è™Ÿ</label>
                <input v-model="adminUsername" type="text" 
                       class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                       placeholder="admin" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">å¯†ç¢¼</label>
                <input v-model="adminPassword" type="password" 
                       class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                       placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
              </div>
              <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition-colors font-medium">
                ğŸ”“ ç™»å…¥å¾Œå°
              </button>
            </form>
            
            <div class="mt-6 text-center text-sm text-gray-500">
              <p>æç¤ºï¼šé»˜èªå¯†ç¢¼æ˜¯ <code class="bg-gray-100 px-2 py-1 rounded">admin123</code></p>
              <a href="demo.html" class="text-indigo-600 hover:underline mt-2 inline-block">â† è¿”å›å‰å°</a>
            </div>
          </div>
        </div>
        
        <div v-else class="min-h-screen bg-gray-100">
          <!-- é ‚éƒ¨å°èˆªæ¬„ -->
          <nav class="bg-white shadow-md sticky top-0 z-50">
            <div class="mx-auto px-6 py-4">
              <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                  <div class="text-3xl">ğŸ«</div>
                  <div>
                    <h1 class="text-xl font-bold text-gray-800">æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹ - å¾Œå°ç®¡ç†</h1>
                    <p class="text-xs text-gray-500">ç®¡ç†å“¡: {{ adminUser }} | å…¨å±€è¦–åœ–</p>
                  </div>
                </div>
                <div class="flex items-center gap-4">
                  <button @click="refreshData" class="btn-secondary text-sm">
                    ğŸ”„ åˆ·æ–°
                  </button>
                  <button @click="handleAdminLogout" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm">
                    ğŸšª ç™»å‡º
                  </button>
                  <a href="demo.html" class="btn-secondary text-sm">
                    â† è¿”å›å‰å°
                  </a>
                </div>
              </div>
            </div>
          </nav>

          <div class="flex">
            <!-- å´é‚Šæ¬„ -->
            <aside class="w-64 bg-white shadow-md min-h-screen p-4">
              <nav class="space-y-2">
                <div @click="currentView = 'dashboard'" 
                     :class="['sidebar-link', { active: currentView === 'dashboard' }]">
                  <span class="text-xl mr-3">ğŸ“Š</span>
                  <span>å„€è¡¨æ¿</span>
                </div>
                <div @click="currentView = 'users'" 
                     :class="['sidebar-link', { active: currentView === 'users' }]">
                  <span class="text-xl mr-3">ğŸ‘¥</span>
                  <span>ç”¨æˆ¶ç®¡ç†</span>
                </div>
                <div @click="currentView = 'tasks'" 
                     :class="['sidebar-link', { active: currentView === 'tasks' }]">
                  <span class="text-xl mr-3">ğŸ“‹</span>
                  <span>ä»»å‹™ç›£æ§</span>
                </div>
                <div @click="currentView = 'statistics'" 
                     :class="['sidebar-link', { active: currentView === 'statistics' }]">
                  <span class="text-xl mr-3">ğŸ“ˆ</span>
                  <span>çµ±è¨ˆåˆ†æ</span>
                </div>
                <div @click="currentView = 'monitor'" 
                     :class="['sidebar-link', { active: currentView === 'monitor' }]">
                  <span class="text-xl mr-3">ğŸ–¥ï¸</span>
                  <span>ç³»çµ±ç›£æ§</span>
                </div>
                <div @click="currentView = 'notifications'" 
                     :class="['sidebar-link', { active: currentView === 'notifications' }]">
                  <span class="text-xl mr-3">ğŸ””</span>
                  <span>é€šçŸ¥è¨˜éŒ„</span>
                </div>
                <div @click="currentView = 'settings'" 
                     :class="['sidebar-link', { active: currentView === 'settings' }]">
                  <span class="text-xl mr-3">âš™ï¸</span>
                  <span>ç³»çµ±è¨­ç½®</span>
                </div>
              </nav>
            </aside>

            <!-- ä¸»å…§å®¹å€ -->
            <main class="flex-1 p-6">
              <!-- å„€è¡¨æ¿è¦–åœ– -->
              <div v-if="currentView === 'dashboard'" class="space-y-6">
                <div class="flex justify-between items-center">
                  <h2 class="text-2xl font-bold text-gray-800">ç³»çµ±æ¦‚è¦½</h2>
                  <div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg text-sm">
                    âš ï¸ ç®¡ç†å“¡æ¨¡å¼ï¼šå¯æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ¶æ•¸æ“š
                  </div>
                </div>
                
                <!-- çµ±è¨ˆå¡ç‰‡ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">ç¸½ç”¨æˆ¶æ•¸</p>
                        <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.totalUsers }}</p>
                      </div>
                      <div class="text-4xl">ğŸ‘¥</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">æ´»èºç”¨æˆ¶: {{ stats.activeUsers }}</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">ç¸½ä»»å‹™æ•¸</p>
                        <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.totalTasks }}</p>
                      </div>
                      <div class="text-4xl">ğŸ“‹</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">é€²è¡Œä¸­: {{ stats.runningTasks }}</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">æˆåŠŸç‡</p>
                        <p class="text-3xl font-bold text-green-600 mt-2">{{ stats.successRate }}%</p>
                      </div>
                      <div class="text-4xl">âœ…</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">æˆåŠŸ: {{ stats.successTasks }}</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">ä»Šæ—¥ä»»å‹™</p>
                        <p class="text-3xl font-bold text-indigo-600 mt-2">{{ stats.todayTasks }}</p>
                      </div>
                      <div class="text-4xl">ğŸ“…</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">æ¯”æ˜¨æ—¥ +{{ stats.todayGrowth }}%</p>
                  </div>
                  
                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">å¾…åŸ·è¡Œ</p>
                        <p class="text-3xl font-bold text-yellow-600 mt-2">{{ stats.pendingTasks }}</p>
                      </div>
                      <div class="text-4xl">â³</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">å·²æš«åœ: {{ stats.pausedTasks }}</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">å¤±æ•—ä»»å‹™</p>
                        <p class="text-3xl font-bold text-red-600 mt-2">{{ stats.failedTasks }}</p>
                      </div>
                      <div class="text-4xl">âŒ</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">éœ€è¦é—œæ³¨</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">å­˜å„²ä½¿ç”¨</p>
                        <p class="text-3xl font-bold text-purple-600 mt-2">{{ systemMetrics.storageUsedMB }}</p>
                      </div>
                      <div class="text-4xl">ğŸ’¾</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">MB å·²ä½¿ç”¨</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">å¹³å‡åŸ·è¡Œ</p>
                        <p class="text-3xl font-bold text-blue-600 mt-2">{{ systemMetrics.avgExecutionTime }}</p>
                      </div>
                      <div class="text-4xl">âš¡</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">ç§’/ä»»å‹™</p>
                  </div>
                </div>

                <!-- åœ–è¡¨å€åŸŸ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ä»»å‹™ç‹€æ…‹åˆ†å¸ƒ</h3>
                    <canvas id="taskStatusChart"></canvas>
                  </div>

                  <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">7æ—¥ä»»å‹™è¶¨å‹¢</h3>
                    <canvas id="taskTrendChart"></canvas>
                  </div>
                </div>

                <!-- æœ€è¿‘æ´»å‹• -->
                <div class="bg-white rounded-xl shadow-md p-6">
                  <h3 class="text-lg font-bold text-gray-800 mb-4">æœ€è¿‘æ´»å‹•</h3>
                  <div class="space-y-3">
                    <div v-for="activity in recentActivities" :key="activity.id" 
                         class="flex items-center justify-between py-3 border-b last:border-0">
                      <div class="flex items-center gap-3">
                        <span class="text-2xl">{{ activity.icon }}</span>
                        <div>
                          <p class="text-sm font-medium text-gray-800">{{ activity.title }}</p>
                          <p class="text-xs text-gray-500">{{ activity.description }}</p>
                        </div>
                      </div>
                      <span class="text-xs text-gray-400">{{ activity.time }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ç”¨æˆ¶ç®¡ç†è¦–åœ– -->
              <div v-if="currentView === 'users'" class="space-y-6">
                <div class="flex justify-between items-center">
                  <div>
                    <h2 class="text-2xl font-bold text-gray-800">ç”¨æˆ¶ç®¡ç†</h2>
                    <p class="text-sm text-gray-600 mt-1">å…± {{ users.length }} å€‹ç”¨æˆ¶ï¼Œ{{ users.filter(u => u.isActive).length }} å€‹æ´»èº</p>
                  </div>
                  <div class="flex gap-3">
                    <input v-model="userSearch" type="text" placeholder="æœç´¢ç”¨æˆ¶..." 
                           class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button @click="exportUsers" class="btn-secondary">ğŸ“¥ å°å‡º</button>
                  </div>
                </div>

                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                  <table class="w-full">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç”¨æˆ¶ID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">è¨»å†Šæ™‚é–“</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ä»»å‹™æ•¸</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æˆåŠŸç‡</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç‹€æ…‹</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ“ä½œ</th>
                      </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                      <tr v-for="user in filteredUsers" :key="user.id" class="table-row">
                        <td class="px-6 py-4 text-sm text-gray-800">{{ user.id.substring(0, 8) }}...</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ formatDate(user.createdAt) }}</td>
                        <td class="px-6 py-4 text-sm text-gray-800">{{ user.taskCount }}</td>
                        <td class="px-6 py-4 text-sm">
                          <span :class="['font-medium', user.successRate > 50 ? 'text-green-600' : 'text-red-600']">
                            {{ user.successRate }}%
                          </span>
                        </td>
                        <td class="px-6 py-4">
                          <span :class="['px-2 py-1 text-xs rounded-full', 
                                       user.isActive ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600']">
                            {{ user.isActive ? 'æ´»èº' : 'éæ´»èº' }}
                          </span>
                        </td>
                        <td class="px-6 py-4 text-sm">
                          <button @click="viewUserDetail(user)" class="text-indigo-600 hover:text-indigo-800">
                            æŸ¥çœ‹
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- ä»»å‹™ç›£æ§è¦–åœ– -->
              <div v-if="currentView === 'tasks'" class="space-y-6">
                <div class="flex justify-between items-center">
                  <div>
                    <h2 class="text-2xl font-bold text-gray-800">ä»»å‹™ç›£æ§</h2>
                    <p class="text-sm text-gray-600 mt-1">
                      âš ï¸ ç®¡ç†å“¡æ¨¡å¼ï¼šé¡¯ç¤ºæ‰€æœ‰ç”¨æˆ¶çš„ {{ tasks.length }} å€‹ä»»å‹™
                    </p>
                  </div>
                  <div class="flex gap-3">
                    <select v-model="taskFilter" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                      <option value="all">å…¨éƒ¨ä»»å‹™</option>
                      <option value="pending">å¾…åŸ·è¡Œ</option>
                      <option value="running">åŸ·è¡Œä¸­</option>
                      <option value="success">å·²æˆåŠŸ</option>
                      <option value="failed">å·²å¤±æ•—</option>
                    </select>
                    <button @click="refreshTasks" class="btn-secondary">ğŸ”„ åˆ·æ–°</button>
                  </div>
                </div>

                <div class="grid grid-cols-1 gap-4">
                  <div v-for="task in filteredTasks" :key="task.id" 
                       class="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start">
                      <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                          <h3 class="text-lg font-bold text-gray-800">{{ task.eventName }}</h3>
                          <span :class="['status-badge', \`status-\${task.status}\`]">
                            {{ getStatusText(task.status) }}
                          </span>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                          <div>
                            <span class="text-gray-500">ç›®æ¨™ç¶²å€:</span> 
                            <a :href="task.targetUrl" target="_blank" class="text-indigo-600 hover:underline ml-1">
                              {{ task.targetUrl }}
                            </a>
                          </div>
                          <div>
                            <span class="text-gray-500">åŸ·è¡Œæ™‚é–“:</span> 
                            <span class="ml-1">{{ formatDateTime(task.executionTime) }}</span>
                          </div>
                          <div>
                            <span class="text-gray-500">å‰µå»ºè€…:</span> 
                            <span class="ml-1">{{ task.userId.substring(0, 8) }}...</span>
                          </div>
                          <div>
                            <span class="text-gray-500">å‰µå»ºæ™‚é–“:</span> 
                            <span class="ml-1">{{ formatDate(task.createdAt) }}</span>
                          </div>
                        </div>
                      </div>
                      <button @click="viewTaskDetail(task)" class="btn-secondary text-sm ml-4">
                        è©³æƒ…
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- çµ±è¨ˆåˆ†æè¦–åœ– -->
              <div v-if="currentView === 'statistics'" class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">çµ±è¨ˆåˆ†æ</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">æ™‚æ®µåˆ†å¸ƒ</h3>
                    <canvas id="hourlyDistChart"></canvas>
                  </div>

                  <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">æˆåŠŸç‡è¶¨å‹¢</h3>
                    <canvas id="successRateChart"></canvas>
                  </div>

                  <div class="bg-white rounded-xl shadow-md p-6 lg:col-span-2">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ç†±é–€æ´»å‹•æ’è¡Œ</h3>
                    <div class="space-y-3">
                      <div v-for="(event, index) in topEvents" :key="index" 
                           class="flex items-center justify-between py-3 border-b last:border-0">
                        <div class="flex items-center gap-3">
                          <span class="text-2xl font-bold text-indigo-600">{{ index + 1 }}</span>
                          <div>
                            <p class="font-medium text-gray-800">{{ event.name }}</p>
                            <p class="text-xs text-gray-500">{{ event.taskCount }} å€‹ä»»å‹™</p>
                          </div>
                        </div>
                        <div class="text-right">
                          <p class="text-sm font-medium text-green-600">{{ event.successRate }}% æˆåŠŸç‡</p>
                          <p class="text-xs text-gray-500">{{ event.totalAttempts }} æ¬¡å˜—è©¦</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- é€šçŸ¥è¨˜éŒ„è¦–åœ– -->
              <div v-if="currentView === 'notifications'" class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">é€šçŸ¥è¨˜éŒ„</h2>

                <div class="bg-white rounded-xl shadow-md p-6">
                  <div class="space-y-3">
                    <div v-for="notif in notifications" :key="notif.id" 
                         class="flex items-start gap-4 py-4 border-b last:border-0">
                      <span class="text-2xl">{{ getNotificationIcon(notif.type) }}</span>
                      <div class="flex-1">
                        <div class="flex items-center justify-between">
                          <p class="font-medium text-gray-800">{{ notif.title }}</p>
                          <span class="text-xs text-gray-400">{{ formatDateTime(notif.timestamp) }}</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">{{ notif.message }}</p>
                        <span :class="['inline-block mt-2 px-2 py-1 text-xs rounded-full',
                                     notif.type === 'success' ? 'bg-green-100 text-green-700' :
                                     notif.type === 'failure' ? 'bg-red-100 text-red-700' :
                                     notif.type === 'warning' ? 'bg-yellow-100 text-yellow-700' :
                                     'bg-blue-100 text-blue-700']">
                          {{ notif.type }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ç³»çµ±è¨­ç½®è¦–åœ– -->
              <div v-if="currentView === 'settings'" class="space-y-6">

              <!-- ç³»çµ±ç›£æ§è¦–åœ–ï¼ˆç®¡ç†å“¡å°ˆç”¨ï¼‰ -->
              <div v-if="currentView === 'monitor'" class="space-y-6">
                <div class="flex justify-between items-center">
                  <div>
                    <h2 class="text-2xl font-bold text-gray-800">ç³»çµ±ç›£æ§</h2>
                    <p class="text-sm text-gray-600 mt-1">âš ï¸ ç®¡ç†å“¡å°ˆç”¨ï¼šå¯¦æ™‚ç³»çµ±æ€§èƒ½ç›£æ§</p>
                  </div>
                  <button @click="loadData" class="btn-primary">ğŸ”„ åˆ·æ–°æ•¸æ“š</button>
                </div>

                <!-- æ€§èƒ½æŒ‡æ¨™ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">å­˜å„²ä½¿ç”¨æƒ…æ³</h3>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600">å·²ä½¿ç”¨ç©ºé–“</span>
                        <span class="font-bold text-purple-600">{{ systemMetrics.storageUsedMB }} MB</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600">å­˜å„²é …ç›®æ•¸</span>
                        <span class="font-bold">{{ systemMetrics.storageKeys }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600">ç¸½ä»»å‹™æ•¸</span>
                        <span class="font-bold">{{ systemMetrics.totalTasks }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">æ€§èƒ½æŒ‡æ¨™</h3>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600">å¹³å‡åŸ·è¡Œæ™‚é–“</span>
                        <span class="font-bold text-blue-600">{{ systemMetrics.avgExecutionTime }}s</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600">æ´»èºç”¨æˆ¶</span>
                        <span class="font-bold text-green-600">{{ stats.activeUsers }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600">é‹è¡Œä¸­ä»»å‹™</span>
                        <span class="font-bold text-yellow-600">{{ stats.runningTasks }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ç³»çµ±ç‹€æ…‹</h3>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600">ç³»çµ±ç‹€æ…‹</span>
                        <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                          âœ“ æ­£å¸¸
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600">æˆåŠŸç‡</span>
                        <span :class="['font-bold', stats.successRate > 50 ? 'text-green-600' : 'text-red-600']">
                          {{ stats.successRate }}%
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600">æœ€å¾Œæ›´æ–°</span>
                        <span class="text-sm text-gray-500">{{ formatDateTime(systemMetrics.timestamp) }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- ç”¨æˆ¶æ´»å‹•æ™‚é–“ç·š -->
                <div class="bg-white rounded-xl shadow-md p-6">
                  <h3 class="text-lg font-bold text-gray-800 mb-4">ç”¨æˆ¶æ´»å‹•åˆ†å¸ƒ</h3>
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                      <p class="text-2xl font-bold text-blue-600">{{ users.filter(u => u.taskCount > 10).length }}</p>
                      <p class="text-sm text-gray-600 mt-1">é‡åº¦ç”¨æˆ¶</p>
                      <p class="text-xs text-gray-500">&gt;10 ä»»å‹™</p>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                      <p class="text-2xl font-bold text-green-600">{{ users.filter(u => u.taskCount >= 5 && u.taskCount <= 10).length }}</p>
                      <p class="text-sm text-gray-600 mt-1">ä¸­åº¦ç”¨æˆ¶</p>
                      <p class="text-xs text-gray-500">5-10 ä»»å‹™</p>
                    </div>
                    <div class="text-center p-4 bg-yellow-50 rounded-lg">
                      <p class="text-2xl font-bold text-yellow-600">{{ users.filter(u => u.taskCount > 0 && u.taskCount < 5).length }}</p>
                      <p class="text-sm text-gray-600 mt-1">è¼•åº¦ç”¨æˆ¶</p>
                      <p class="text-xs text-gray-500">1-4 ä»»å‹™</p>
                    </div>
                    <div class="text-center p-4 bg-gray-50 rounded-lg">
                      <p class="text-2xl font-bold text-gray-600">{{ users.filter(u => u.taskCount === 0).length }}</p>
                      <p class="text-sm text-gray-600 mt-1">æ–°ç”¨æˆ¶</p>
                      <p class="text-xs text-gray-500">0 ä»»å‹™</p>
                    </div>
                  </div>
                </div>

                <!-- å±éšªæ“ä½œå€ -->
                <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6">
                  <h3 class="text-lg font-bold text-red-800 mb-4">âš ï¸ å±éšªæ“ä½œå€</h3>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button @click="clearOldTasks" class="bg-yellow-600 text-white px-4 py-3 rounded-lg hover:bg-yellow-700">
                      ğŸ—‘ï¸ æ¸…ç† 30 å¤©å‰ä»»å‹™
                    </button>
                    <button @click="exportAllData" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700">
                      ğŸ“¥ å°å‡ºæ‰€æœ‰æ•¸æ“š
                    </button>
                    <button @click="resetSystem" class="bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700">
                      âš ï¸ é‡ç½®æ•´å€‹ç³»çµ±
                    </button>
                  </div>
                </div>
              </div>

                <h2 class="text-2xl font-bold text-gray-800">ç³»çµ±è¨­ç½®</h2>

                <div class="bg-white rounded-xl shadow-md p-6">
                  <h3 class="text-lg font-bold text-gray-800 mb-4">é€šçŸ¥è¨­ç½®</h3>
                  <div class="space-y-4">
                    <label class="flex items-center justify-between">
                      <span class="text-gray-700">å•Ÿç”¨æ¡Œé¢é€šçŸ¥</span>
                      <input type="checkbox" v-model="settings.enableNotifications" class="toggle">
                    </label>
                    <label class="flex items-center justify-between">
                      <span class="text-gray-700">ä»»å‹™æˆåŠŸæ™‚é€šçŸ¥</span>
                      <input type="checkbox" v-model="settings.notifyOnSuccess" class="toggle">
                    </label>
                    <label class="flex items-center justify-between">
                      <span class="text-gray-700">ä»»å‹™å¤±æ•—æ™‚é€šçŸ¥</span>
                      <input type="checkbox" v-model="settings.notifyOnFailure" class="toggle">
                    </label>
                  </div>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6">
                  <h3 class="text-lg font-bold text-gray-800 mb-4">æ•¸æ“šç®¡ç†</h3>
                  <div class="space-y-3">
                    <button @click="exportAllData" class="btn-primary w-full">
                      ğŸ“¥ å°å‡ºæ‰€æœ‰æ•¸æ“š
                    </button>
                    <button @click="clearOldTasks" class="btn-secondary w-full">
                      ğŸ—‘ï¸ æ¸…ç†èˆŠä»»å‹™ï¼ˆ30å¤©å‰ï¼‰
                    </button>
                    <button @click="resetSystem" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 w-full">
                      âš ï¸ é‡ç½®ç³»çµ±
                    </button>
                  </div>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6">
                  <h3 class="text-lg font-bold text-gray-800 mb-4">ç³»çµ±è³‡è¨Š</h3>
                  <div class="space-y-2 text-sm text-gray-600">
                    <p><span class="font-medium">ç‰ˆæœ¬:</span> v0.5</p>
                    <p><span class="font-medium">æœ€å¾Œæ›´æ–°:</span> 2025-12-17</p>
                    <p><span class="font-medium">æ•¸æ“šå„²å­˜:</span> GUN.js (å»ä¸­å¿ƒåŒ–)</p>
                    <p><span class="font-medium">å‰ç«¯æ¡†æ¶:</span> Vue 3</p>
                  </div>
                </div>
              </div>
            </main>
          </div>
        </div>
      `,
      setup() {
        const isAdminLoggedIn = ref(false)
        const adminUsername = ref('admin')
        const adminPassword = ref('')
        const loginError = ref('')
        const currentView = ref('dashboard')
        const adminUser = ref('Admin')
        const userSearch = ref('')
        const taskFilter = ref('all')
        
        const stats = reactive({
          totalUsers: 0,
          activeUsers: 0,
          totalTasks: 0,
          runningTasks: 0,
          successRate: 0,
          successTasks: 0,
          todayTasks: 0,
          todayGrowth: 0
        })

        const users = ref([])
        const tasks = ref([])
        const notifications = ref([])
        const recentActivities = ref([])
        const topEvents = ref([])

        const settings = reactive({
          enableNotifications: true,
          notifyOnSuccess: true,
          notifyOnFailure: true
        })
        
        const systemMetrics = reactive({
          storageUsedMB: 0,
          avgExecutionTime: 0,
          storageKeys: 0
        })

        // è¨ˆç®—å±¬æ€§
        const filteredUsers = computed(() => {
          if (!userSearch.value) return users.value
          return users.value.filter(u => 
            u.id.toLowerCase().includes(userSearch.value.toLowerCase())
          )
        })

        const filteredTasks = computed(() => {
          if (taskFilter.value === 'all') return tasks.value
          return tasks.value.filter(t => t.status === taskFilter.value)
        })

        // æ–¹æ³•
        const handleAdminLogin = () => {
          // ç°¡å–®çš„å¯†ç¢¼é©—è­‰ï¼ˆå¯¦éš›æ‡‰ç”¨æ‡‰è©²ä½¿ç”¨åŠ å¯†å’Œå¾Œç«¯é©—è­‰ï¼‰
          if (adminUsername.value === 'admin' && adminPassword.value === 'admin123') {
            isAdminLoggedIn.value = true
            loginError.value = ''
            localStorage.setItem('adminSession', 'true')
            loadData()
          } else {
            loginError.value = 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤'
          }
        }
        
        const handleAdminLogout = () => {
          if (confirm('ç¢ºå®šè¦ç™»å‡ºå¾Œå°ç®¡ç†ç³»çµ±å—ï¼Ÿ')) {
            isAdminLoggedIn.value = false
            localStorage.removeItem('adminSession')
            adminPassword.value = ''
          }
        }
        
        const checkAdminSession = () => {
          // æª¢æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„ç®¡ç†å“¡æœƒè©±
          const session = localStorage.getItem('adminSession')
          if (session === 'true') {
            isAdminLoggedIn.value = true
          }
        }

        const loadData = async () => {
          try {
            const data = await adminSystem.getDashboardData()
            Object.assign(stats, data.stats)
            users.value = data.users
            tasks.value = data.tasks
            recentActivities.value = data.recentActivities
            topEvents.value = data.topEvents
            
            // ç²å–é€šçŸ¥æ­·å²
            notifications.value = notificationSystem.getNotificationHistory()
            
            // ç²å–ç³»çµ±æ€§èƒ½æŒ‡æ¨™
            const metrics = await adminSystem.getSystemMetrics()
            Object.assign(systemMetrics, metrics)
          } catch (error) {
            console.error('åŠ è¼‰æ•¸æ“šå¤±æ•—:', error)
          }
        }

        const refreshData = () => {
          loadData()
          renderCharts()
        }

        const refreshTasks = async () => {
          const allTasks = await botEngine.getAllTasks()
          tasks.value = allTasks
        }

        const formatDate = (dateStr) => {
          if (!dateStr) return '-'
          const date = new Date(dateStr)
          return date.toLocaleDateString('zh-TW')
        }

        const formatDateTime = (dateStr) => {
          if (!dateStr) return '-'
          const date = new Date(dateStr)
          return date.toLocaleString('zh-TW')
        }

        const getStatusText = (status) => {
          const statusMap = {
            'pending': 'å¾…åŸ·è¡Œ',
            'running': 'åŸ·è¡Œä¸­',
            'success': 'å·²æˆåŠŸ',
            'failed': 'å·²å¤±æ•—',
            'paused': 'å·²æš«åœ'
          }
          return statusMap[status] || status
        }

        const getNotificationIcon = (type) => {
          const iconMap = {
            'success': 'âœ…',
            'failure': 'âŒ',
            'progress': 'â³',
            'warning': 'âš ï¸'
          }
          return iconMap[type] || 'ğŸ“¢'
        }

        const viewUserDetail = (user) => {
          alert(`ç”¨æˆ¶è©³æƒ…ï¼š\n\nID: ${user.id}\nä»»å‹™æ•¸: ${user.taskCount}\næˆåŠŸç‡: ${user.successRate}%`)
        }

        const viewTaskDetail = (task) => {
          alert(`ä»»å‹™è©³æƒ…ï¼š\n\nåç¨±: ${task.eventName}\nç‹€æ…‹: ${getStatusText(task.status)}\nç¶²å€: ${task.targetUrl}`)
        }

        const exportUsers = () => {
          const csv = adminSystem.exportUsersToCSV(users.value)
          downloadFile('users.csv', csv)
        }

        const exportAllData = () => {
          const json = JSON.stringify({ users: users.value, tasks: tasks.value }, null, 2)
          downloadFile('all-data.json', json)
        }

        const clearOldTasks = async () => {
          if (confirm('ç¢ºå®šè¦æ¸…ç† 30 å¤©å‰çš„èˆŠä»»å‹™å—ï¼Ÿ')) {
            const count = await adminSystem.clearOldTasks(30)
            alert(`å·²æ¸…ç† ${count} å€‹èˆŠä»»å‹™`)
            loadData()
          }
        }

        const resetSystem = () => {
          if (confirm('è­¦å‘Šï¼šé€™å°‡æ¸…é™¤æ‰€æœ‰æ•¸æ“šï¼ç¢ºå®šè¦é‡ç½®ç³»çµ±å—ï¼Ÿ')) {
            if (confirm('æœ€å¾Œç¢ºèªï¼šçœŸçš„è¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
              localStorage.clear()
              alert('ç³»çµ±å·²é‡ç½®')
              location.reload()
            }
          }
        }

        const downloadFile = (filename, content) => {
          const blob = new Blob([content], { type: 'text/plain' })
          const url = URL.createObjectURL(blob)
          const a = document.createElement('a')
          a.href = url
          a.download = filename
          a.click()
          URL.revokeObjectURL(url)
        }

        const renderCharts = () => {
          // ä»»å‹™ç‹€æ…‹åˆ†å¸ƒåœ–
          const taskStatusCtx = document.getElementById('taskStatusChart')
          if (taskStatusCtx) {
            new Chart(taskStatusCtx, {
              type: 'doughnut',
              data: {
                labels: ['å¾…åŸ·è¡Œ', 'åŸ·è¡Œä¸­', 'å·²æˆåŠŸ', 'å·²å¤±æ•—'],
                datasets: [{
                  data: [
                    tasks.value.filter(t => t.status === 'pending').length,
                    tasks.value.filter(t => t.status === 'running').length,
                    tasks.value.filter(t => t.status === 'success').length,
                    tasks.value.filter(t => t.status === 'failed').length
                  ],
                  backgroundColor: ['#FCD34D', '#60A5FA', '#34D399', '#F87171']
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: true
              }
            })
          }

          // 7æ—¥ä»»å‹™è¶¨å‹¢åœ–
          const taskTrendCtx = document.getElementById('taskTrendChart')
          if (taskTrendCtx) {
            const last7Days = Array.from({ length: 7 }, (_, i) => {
              const d = new Date()
              d.setDate(d.getDate() - (6 - i))
              return d.toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' })
            })
            
            new Chart(taskTrendCtx, {
              type: 'line',
              data: {
                labels: last7Days,
                datasets: [{
                  label: 'ä»»å‹™æ•¸é‡',
                  data: [12, 19, 15, 25, 22, 30, 28],
                  borderColor: '#6366F1',
                  backgroundColor: 'rgba(99, 102, 241, 0.1)',
                  tension: 0.4
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: true
              }
            })
          }
        }

        onMounted(async () => {
          checkAdminSession()
          if (!isAdminLoggedIn.value) return
          
          await initGUN()
          await loadData()
          
          // å»¶é²æ¸²æŸ“åœ–è¡¨ï¼Œç¢ºä¿ DOM å·²åŠ è¼‰
          setTimeout(renderCharts, 500)
        })

        watch(currentView, () => {
          // ç•¶åˆ‡æ›åˆ° dashboard æ™‚é‡æ–°æ¸²æŸ“åœ–è¡¨
          if (currentView.value === 'dashboard') {
            setTimeout(renderCharts, 100)
          }
        })

        return {
          isAdminLoggedIn,
          adminUsername,
          adminPassword,
          loginError,
          handleAdminLogin,
          handleAdminLogout,
          currentView,
          adminUser,
          userSearch,
          taskFilter,
          stats,
          users,
          tasks,
          notifications,
          recentActivities,
          topEvents,
          settings,
          systemMetrics,
          filteredUsers,
          filteredTasks,
          refreshData,
          refreshTasks,
          formatDate,
          formatDateTime,
          getStatusText,
          getNotificationIcon,
          viewUserDetail,
          viewTaskDetail,
          exportUsers,
          exportAllData,
          clearOldTasks,
          resetSystem
        }
      }
    })

    app.mount('#app')
  </script>
</body>
</html>
