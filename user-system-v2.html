<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹ - ç”¨æˆ¶ç³»çµ± + å”ä½œåŠŸèƒ½</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun@0.2020.x/gun.js"></script>
  <style>
    .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    .slide-enter-active, .slide-leave-active { transition: transform 0.3s; }
    .slide-enter-from { transform: translateX(-100%); }
    .slide-leave-to { transform: translateX(100%); }
    .invite-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .collaboration-card {
      border-left: 4px solid #667eea;
      transition: all 0.3s;
    }
    .collaboration-card:hover {
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }
    .friend-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 0.875rem;
    }
    .online-indicator {
      width: 12px;
      height: 12px;
      background: #10b981;
      border-radius: 50%;
      display: inline-block;
      margin-right: 0.5rem;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app">
    <!-- å°èˆªæ¬„ -->
    <nav class="bg-white border-b border-gray-200 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center space-x-2">
            <div class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
              ğŸ« æ¶ç¥¨åŠ©æ‰‹
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <div class="text-sm text-gray-600" v-if="currentUser">
              æ­¡è¿ <span class="font-semibold">{{ currentUser }}</span>
            </div>
            <button @click="logout" class="px-3 py-1 text-sm text-gray-600 hover:text-gray-900">ç™»å‡º</button>
          </div>
        </div>
      </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div v-if="!currentUser" class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 flex items-center justify-center">
      <!-- ç™»å…¥/è¨»å†Šè¡¨å–® -->
      <div class="w-full max-w-md">
        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-2xl font-bold text-center mb-6">{{ showRegister ? 'å‰µå»ºå¸³æˆ¶' : 'ç™»å…¥' }}</h2>

          <form @submit.prevent="showRegister ? register() : login()" class="space-y-4">
            <input v-model="authForm.email" type="email" placeholder="é›»éƒµ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            <input v-model="authForm.password" type="password" placeholder="å¯†ç¢¼" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            <input v-if="showRegister" v-model="authForm.username" type="text" placeholder="ç”¨æˆ¶å" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">

            <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 rounded-lg font-semibold hover:opacity-90">
              {{ showRegister ? 'è¨»å†Š' : 'ç™»å…¥' }}
            </button>
          </form>

          <div class="mt-4 text-center">
            <button @click="showRegister = !showRegister" class="text-sm text-purple-600 hover:text-purple-700">
              {{ showRegister ? 'å·²æœ‰å¸³æˆ¶ï¼Ÿç™»å…¥' : 'æ²’æœ‰å¸³æˆ¶ï¼Ÿè¨»å†Š' }}
            </button>
          </div>

          <div class="mt-6 pt-6 border-t border-gray-200">
            <p class="text-xs text-gray-500 text-center mb-3">æ¸¬è©¦å¸³è™Ÿ</p>
            <div class="space-y-2">
              <button @click="quickLogin('alice')" class="w-full bg-gray-100 hover:bg-gray-200 py-2 rounded text-sm font-semibold">
                å¿«é€Ÿç™»å…¥: Alice
              </button>
              <button @click="quickLogin('bob')" class="w-full bg-gray-100 hover:bg-gray-200 py-2 rounded text-sm font-semibold">
                å¿«é€Ÿç™»å…¥: Bob
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸»æ‡‰ç”¨ -->
    <div v-else class="min-h-screen">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- åˆ†é å°èˆª -->
        <div class="flex space-x-1 mb-8 border-b border-gray-200 overflow-x-auto">
          <button
            v-for="tab in tabs"
            :key="tab.id"
            @click="activeTab = tab.id"
            :class="[
              'px-4 py-3 font-medium text-sm whitespace-nowrap border-b-2 transition',
              activeTab === tab.id
                ? 'border-purple-600 text-purple-600'
                : 'border-transparent text-gray-600 hover:text-gray-900'
            ]"
          >
            {{ tab.icon }} {{ tab.name }}
            <span v-if="tab.id === 'invitations' && pendingInvitations.length > 0" class="invite-badge ml-2">
              {{ pendingInvitations.length }}
            </span>
          </button>
        </div>

        <!-- å„€è¡¨æ¿ -->
        <div v-if="activeTab === 'dashboard'" class="space-y-6">
          <!-- çµ±è¨ˆå¡ç‰‡ -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="bg-white rounded-lg shadow p-6">
              <div class="text-3xl font-bold text-purple-600">{{ userStats.totalTasks }}</div>
              <div class="text-gray-600 text-sm mt-2">ä»»å‹™ç¸½æ•¸</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
              <div class="text-3xl font-bold text-blue-600">{{ userStats.completedTasks }}</div>
              <div class="text-gray-600 text-sm mt-2">å·²å®Œæˆä»»å‹™</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
              <div class="text-3xl font-bold text-green-600">{{ userStats.totalFriends }}</div>
              <div class="text-gray-600 text-sm mt-2">æœ‹å‹æ•¸é‡</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
              <div class="text-3xl font-bold text-orange-600">{{ userStats.activeCollaborations }}</div>
              <div class="text-gray-600 text-sm mt-2">å”ä½œé …ç›®</div>
            </div>
          </div>

          <!-- æœ‹å‹å¿«é€Ÿè¨ªå• -->
          <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold mb-4">ğŸ‘¥ æˆ‘çš„æœ‹å‹</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div v-for="friend in friends" :key="friend.username" class="flex flex-col items-center p-3 border rounded-lg hover:bg-gray-50 transition cursor-pointer">
                <div class="friend-avatar mb-2">{{ friend.username.charAt(0).toUpperCase() }}</div>
                <div class="text-sm font-semibold">{{ friend.username }}</div>
                <div class="text-xs text-gray-500 mt-1">{{ friend.mutualTasks.length }} å…±äº«ä»»å‹™</div>
              </div>
            </div>
          </div>

          <!-- æœ€è¿‘å”ä½œ -->
          <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold mb-4">ğŸ¤ æœ€è¿‘å”ä½œ</h3>
            <div class="space-y-3">
              <div v-for="collab in recentCollaborations.slice(0, 3)" :key="collab.id" class="collaboration-card bg-gray-50 rounded p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-semibold">{{ collab.task.title }}</div>
                    <div class="text-sm text-gray-600">å”ä½œè€…: {{ collab.collaborators.map(c => c.username).join(', ') }}</div>
                  </div>
                  <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">é€²è¡Œä¸­</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- æœ‹å‹ç®¡ç† -->
        <div v-if="activeTab === 'friends'" class="space-y-6">
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-lg font-bold">ğŸ‘¥ æœ‹å‹åˆ—è¡¨</h3>
              <button @click="showInviteModal = true" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 text-sm font-semibold">
                + é‚€è«‹æœ‹å‹
              </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div v-for="friend in friends" :key="friend.username" class="border rounded-lg p-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="friend-avatar">{{ friend.username.charAt(0).toUpperCase() }}</div>
                  <div>
                    <div class="font-semibold">{{ friend.username }}</div>
                    <div class="text-xs text-gray-500">å·²æ·»åŠ  {{ formatDate(friend.addedAt) }}</div>
                  </div>
                </div>
                <button @click="removeFriend(friend.username)" class="text-red-600 hover:text-red-700 text-sm font-semibold">ç§»é™¤</button>
              </div>
            </div>

            <div v-if="friends.length === 0" class="text-center py-8 text-gray-500">
              æš«ç„¡æœ‹å‹ï¼Œé‚€è«‹ä¸€äº›æœ‹å‹é–‹å§‹å”ä½œå§ï¼
            </div>
          </div>
        </div>

        <!-- é‚€è«‹ç®¡ç† -->
        <div v-if="activeTab === 'invitations'" class="space-y-6">
          <!-- å¾…è™•ç†é‚€è«‹ -->
          <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold mb-4">ğŸ“¨ å¾…è™•ç†é‚€è«‹ {{ pendingInvitations.length > 0 ? `(${pendingInvitations.length})` : '' }}</h3>
            <div class="space-y-3">
              <div v-for="invite in pendingInvitations" :key="invite.id" class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-semibold">{{ invite.from }} é‚€è«‹ä½ æˆç‚ºæœ‹å‹</div>
                    <div class="text-sm text-gray-600 mt-1">{{ invite.message || 'è®“æˆ‘å€‘é–‹å§‹å”ä½œå§ï¼' }}</div>
                    <div class="text-xs text-gray-500 mt-2">
                      æœ‰æ•ˆæœŸè‡³: {{ formatDate(invite.expiresAt) }}
                    </div>
                  </div>
                  <div class="flex space-x-2">
                    <button @click="acceptInvite(invite.code)" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm font-semibold">
                      æ¥å—
                    </button>
                    <button @click="declineInvite(invite.code)" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 text-sm font-semibold">
                      æ‹’çµ•
                    </button>
                  </div>
                </div>
              </div>

              <div v-if="pendingInvitations.length === 0" class="text-center py-8 text-gray-500">
                æ²’æœ‰å¾…è™•ç†çš„é‚€è«‹
              </div>
            </div>
          </div>

          <!-- å·²ç™¼é€é‚€è«‹ -->
          <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold mb-4">ğŸ“¤ å·²ç™¼é€é‚€è«‹</h3>
            <div class="space-y-3">
              <div v-for="invite in sentInvitations" :key="invite.id" class="bg-gray-50 border rounded-lg p-4 flex items-center justify-between">
                <div>
                  <div class="font-semibold">{{ invite.to }}</div>
                  <div class="text-sm text-gray-600">ç‹€æ…‹: <span :class="[
                    'font-semibold',
                    invite.status === 'pending' ? 'text-yellow-600' :
                    invite.status === 'accepted' ? 'text-green-600' :
                    'text-red-600'
                  ]">{{ invite.status === 'pending' ? 'å¾…å›æ‡‰' : invite.status === 'accepted' ? 'å·²æ¥å—' : 'å·²æ‹’çµ•' }}</span></div>
                </div>
                <div v-if="invite.status === 'pending'" class="flex space-x-2">
                  <button @click="resendInvite(invite.id)" class="text-blue-600 hover:text-blue-700 text-sm font-semibold">é‡æ–°ç™¼é€</button>
                  <button @click="cancelInvite(invite.id)" class="text-gray-600 hover:text-gray-700 text-sm font-semibold">å–æ¶ˆ</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- å”ä½œä»»å‹™ -->
        <div v-if="activeTab === 'collaborations'" class="space-y-6">
          <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold mb-6">ğŸ¤ æˆ‘çš„å”ä½œ</h3>

            <div v-if="userCollaborations.length === 0" class="text-center py-8 text-gray-500">
              æš«ç„¡å”ä½œé …ç›®ï¼Œé‚€è«‹æœ‹å‹é–‹å§‹å”ä½œå§ï¼
            </div>

            <div v-else class="space-y-4">
              <div v-for="collab in userCollaborations" :key="collab.id" class="collaboration-card bg-white border rounded-lg p-4">
                <div class="flex items-start justify-between mb-3">
                  <div>
                    <h4 class="font-bold text-lg">{{ collab.task.title }}</h4>
                    <p class="text-sm text-gray-600 mt-1">{{ collab.task.description }}</p>
                  </div>
                  <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">{{ collab.status }}</span>
                </div>

                <!-- å”ä½œè€…åˆ—è¡¨ -->
                <div class="mb-4">
                  <div class="text-sm font-semibold text-gray-700 mb-2">å”ä½œè€…:</div>
                  <div class="flex flex-wrap gap-2">
                    <div v-for="collab in collab.collaborators" :key="collab.username" class="flex items-center bg-purple-50 px-3 py-1 rounded-full text-sm">
                      <span class="inline-block w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                      {{ collab.username }} <span class="text-xs text-gray-600 ml-1">({{ collab.role }})</span>
                    </div>
                  </div>
                </div>

                <!-- è©•è«–å€ -->
                <div class="bg-gray-50 rounded p-3 mb-3">
                  <div class="text-sm font-semibold mb-2">ğŸ’¬ è©•è«– ({{ collab.comments.length }})</div>
                  <div class="space-y-2 max-h-32 overflow-y-auto">
                    <div v-for="comment in collab.comments" :key="comment.id" class="text-sm bg-white rounded p-2">
                      <div class="font-semibold">{{ comment.author }}</div>
                      <div class="text-gray-700">{{ comment.content }}</div>
                    </div>
                  </div>
                </div>

                <!-- æ·»åŠ è©•è«– -->
                <div class="flex gap-2">
                  <input
                    v-model="newComment[collab.id]"
                    type="text"
                    placeholder="æ·»åŠ è©•è«–..."
                    class="flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                    @keyup.enter="addCommentToCollab(collab.id)"
                  >
                  <button @click="addCommentToCollab(collab.id)" class="bg-purple-600 text-white px-4 py-2 rounded text-sm font-semibold hover:bg-purple-700">
                    ç™¼é€
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ä»»å‹™ç®¡ç† -->
        <div v-if="activeTab === 'tasks'" class="space-y-6">
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-lg font-bold">ğŸ“‹ æˆ‘çš„ä»»å‹™</h3>
              <button @click="showTaskModal = true" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 text-sm font-semibold">
                + æ–°å»ºä»»å‹™
              </button>
            </div>

            <!-- æœå°‹å’Œéæ¿¾ -->
            <div class="flex gap-3 mb-6">
              <input
                v-model="taskSearch"
                type="text"
                placeholder="æœå°‹ä»»å‹™..."
                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
              >
              <select v-model="taskFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                <option value="pending">å¾…æ©Ÿ</option>
                <option value="completed">å·²å®Œæˆ</option>
              </select>
            </div>

            <!-- ä»»å‹™åˆ—è¡¨ -->
            <div class="space-y-3">
              <div v-for="task in filteredTasks" :key="task.id" class="border rounded-lg p-4 hover:bg-gray-50 transition">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h4 class="font-semibold">{{ task.title }}</h4>
                    <p class="text-sm text-gray-600 mt-1">{{ task.description }}</p>
                    <div class="flex gap-2 mt-3">
                      <span :class="[
                        'text-xs px-2 py-1 rounded font-semibold',
                        task.status === 'pending' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'
                      ]">
                        {{ task.status === 'pending' ? 'å¾…æ©Ÿ' : 'å·²å®Œæˆ' }}
                      </span>
                      <span v-if="task.isShared" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded font-semibold">ğŸ”— å·²å…±äº«</span>
                    </div>
                  </div>
                  <button @click="shareTaskWithFriends(task)" class="text-purple-600 hover:text-purple-700 font-semibold text-sm">
                    å…±äº«
                  </button>
                </div>
              </div>

              <div v-if="filteredTasks.length === 0" class="text-center py-8 text-gray-500">
                æ²’æœ‰æ‰¾åˆ°åŒ¹é…çš„ä»»å‹™
              </div>
            </div>
          </div>
        </div>

        <!-- è¨­ç½® -->
        <div v-if="activeTab === 'settings'" class="space-y-6">
          <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold mb-6">âš™ï¸ è¨­ç½®</h3>

            <div class="space-y-4">
              <div class="border-b pb-4">
                <label class="flex items-center space-x-3 cursor-pointer">
                  <input type="checkbox" v-model="settings.enableNotifications" class="w-4 h-4 text-purple-600">
                  <span class="font-semibold">å•Ÿç”¨é€šçŸ¥</span>
                </label>
              </div>

              <div class="border-b pb-4">
                <label class="flex items-center space-x-3 cursor-pointer">
                  <input type="checkbox" v-model="settings.allowInvites" class="w-4 h-4 text-purple-600">
                  <span class="font-semibold">å…è¨±ä»–äººé‚€è«‹</span>
                </label>
              </div>

              <div class="border-b pb-4">
                <label class="flex items-center space-x-3 cursor-pointer">
                  <input type="checkbox" v-model="settings.darkMode" class="w-4 h-4 text-purple-600">
                  <span class="font-semibold">æ·±è‰²ä¸»é¡Œ</span>
                </label>
              </div>

              <div class="pt-4">
                <button @click="exportData" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mr-2 font-semibold">
                  ğŸ’¾ å°å‡ºæ•¸æ“š
                </button>
                <button @click="clearData" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 font-semibold">
                  ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•¸æ“š
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- é‚€è«‹æœ‹å‹æ¨¡æ…‹æ¡† -->
    <div v-if="showInviteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">é‚€è«‹æœ‹å‹</h2>

        <form @submit.prevent="inviteFriend" class="space-y-4">
          <input
            v-model="inviteForm.email"
            type="email"
            placeholder="æœ‹å‹çš„é›»éƒµ"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
          >
          <textarea
            v-model="inviteForm.message"
            placeholder="é‚€è«‹ä¿¡æ¯ï¼ˆå¯é¸ï¼‰"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"
            rows="3"
          ></textarea>

          <div class="flex gap-2">
            <button type="submit" class="flex-1 bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700">
              ç™¼é€é‚€è«‹
            </button>
            <button type="button" @click="showInviteModal = false" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-400">
              å–æ¶ˆ
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- æ–°å»ºä»»å‹™æ¨¡æ…‹æ¡† -->
    <div v-if="showTaskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">æ–°å»ºä»»å‹™</h2>

        <form @submit.prevent="createTask" class="space-y-4">
          <input
            v-model="taskForm.title"
            type="text"
            placeholder="ä»»å‹™æ¨™é¡Œ"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
          >
          <textarea
            v-model="taskForm.description"
            placeholder="ä»»å‹™æè¿°"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"
            rows="3"
          ></textarea>

          <div class="flex gap-2">
            <button type="submit" class="flex-1 bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700">
              å‰µå»º
            </button>
            <button type="button" @click="showTaskModal = false" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-400">
              å–æ¶ˆ
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, reactive, computed } = Vue

    // å°å…¥å”ä½œç³»çµ±
    async function loadCollaborationSystem() {
      const script = document.createElement('script')
      script.src = './js/collaboration.js'
      script.type = 'module'
      document.head.appendChild(script)
    }

    createApp({
      setup() {
        // ç‹€æ…‹
        const currentUser = ref(null)
        const activeTab = ref('dashboard')
        const showRegister = ref(false)
        const showInviteModal = ref(false)
        const showTaskModal = ref(false)
        const taskSearch = ref('')
        const taskFilter = ref('')

        // è¡¨å–®æ•¸æ“š
        const authForm = reactive({ email: '', password: '', username: '' })
        const inviteForm = reactive({ email: '', message: '' })
        const taskForm = reactive({ title: '', description: '' })
        const newComment = reactive({})

        // æ‡‰ç”¨æ•¸æ“š
        const friends = ref([])
        const tasks = ref([])
        const pendingInvitations = ref([])
        const sentInvitations = ref([])
        const userCollaborations = ref([])

        // è¨­ç½®
        const settings = reactive({
          enableNotifications: true,
          allowInvites: true,
          darkMode: false
        })

        // åˆ†é é…ç½®
        const tabs = [
          { id: 'dashboard', name: 'å„€è¡¨æ¿', icon: 'ğŸ“Š' },
          { id: 'friends', name: 'æœ‹å‹', icon: 'ğŸ‘¥' },
          { id: 'invitations', name: 'é‚€è«‹', icon: 'ğŸ“¨' },
          { id: 'collaborations', name: 'å”ä½œ', icon: 'ğŸ¤' },
          { id: 'tasks', name: 'ä»»å‹™', icon: 'ğŸ“‹' },
          { id: 'settings', name: 'è¨­ç½®', icon: 'âš™ï¸' }
        ]

        // è¨ˆç®—å±¬æ€§
        const userStats = computed(() => ({
          totalTasks: tasks.value.length,
          completedTasks: tasks.value.filter(t => t.status === 'completed').length,
          totalFriends: friends.value.length,
          activeCollaborations: userCollaborations.value.length
        }))

        const filteredTasks = computed(() => {
          let result = tasks.value
          if (taskSearch.value) {
            result = result.filter(t =>
              t.title.toLowerCase().includes(taskSearch.value.toLowerCase())
            )
          }
          if (taskFilter.value) {
            result = result.filter(t => t.status === taskFilter.value)
          }
          return result
        })

        const recentCollaborations = computed(() =>
          userCollaborations.value.slice().reverse()
        )

        // æ–¹æ³•
        const login = () => {
          if (authForm.email && authForm.password) {
            currentUser.value = authForm.email.split('@')[0]
            authForm.email = ''
            authForm.password = ''
            initializeUserData()
          }
        }

        const register = () => {
          if (authForm.email && authForm.password && authForm.username) {
            currentUser.value = authForm.username
            authForm.email = ''
            authForm.password = ''
            authForm.username = ''
            initializeUserData()
          }
        }

        const quickLogin = (username) => {
          currentUser.value = username
          initializeUserData()
        }

        const logout = () => {
          currentUser.value = null
          friends.value = []
          tasks.value = []
          pendingInvitations.value = []
          sentInvitations.value = []
          userCollaborations.value = []
        }

        const initializeUserData = () => {
          // æ¨¡æ“¬æ•¸æ“š
          const mockFriends = {
            alice: ['bob', 'charlie'],
            bob: ['alice', 'david'],
            charlie: ['alice'],
            david: ['bob']
          }

          const mockTasks = {
            alice: [
              { id: '1', title: '2025å¹´æ¼”å”±æœƒ', description: 'æ¶è³¼ Coldplay æ¼”å”±æœƒé–€ç¥¨', status: 'pending', isShared: false },
              { id: '2', title: 'Taylor Swift æ¼”å‡º', description: 'åˆå¤œå·¡è¿´æ¼”å”±æœƒ', status: 'pending', isShared: true }
            ],
            bob: [
              { id: '3', title: 'ç„¡ææ¨‚éšŠæ¼”å‡º', description: 'æ¶è³¼æ¼”å”±æœƒé–€ç¥¨', status: 'completed', isShared: false }
            ]
          }

          if (mockFriends[currentUser.value]) {
            friends.value = mockFriends[currentUser.value].map(f => ({
              username: f,
              addedAt: Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000,
              mutualTasks: [1, 2]
            }))
          }

          if (mockTasks[currentUser.value]) {
            tasks.value = mockTasks[currentUser.value]
          }

          // æ¨¡æ“¬å¾…æ©Ÿé‚€è«‹
          if (currentUser.value === 'alice') {
            pendingInvitations.value = [{
              id: '1',
              from: 'charlie',
              code: 'INV-CHARLIE-001',
              message: 'è®“æˆ‘å€‘é–‹å§‹å”ä½œå§ï¼',
              expiresAt: Date.now() + 7 * 24 * 60 * 60 * 1000
            }]
          }

          // æ¨¡æ“¬å”ä½œé …ç›®
          userCollaborations.value = [{
            id: 'collab-1',
            task: { title: '2025å¹´æ¼”å”±æœƒé–€ç¥¨æ¶è³¼è¨ˆåŠƒ', description: 'èˆ‡æœ‹å‹å”ä½œæ¶è³¼æ¼”å”±æœƒé–€ç¥¨' },
            collaborators: [
              { username: currentUser.value, role: 'owner', joinedAt: Date.now() },
              { username: friends.value[0]?.username || 'friend', role: 'editor', joinedAt: Date.now() }
            ],
            status: 'active',
            comments: [
              { id: '1', author: currentUser.value, content: 'æˆ‘å·²æº–å‚™å¥½äº†ï¼' },
              { id: '2', author: friends.value[0]?.username || 'friend', content: 'æˆ‘ä¹Ÿæ˜¯ï¼' }
            ]
          }]
        }

        const inviteFriend = () => {
          if (inviteForm.email) {
            sentInvitations.value.push({
              id: `invite-${Date.now()}`,
              from: currentUser.value,
              to: inviteForm.email.split('@')[0],
              code: `INV-${Math.random().toString(36).substring(2, 8).toUpperCase()}`,
              status: 'pending',
              createdAt: Date.now(),
              expiresAt: Date.now() + 7 * 24 * 60 * 60 * 1000
            })
            inviteForm.email = ''
            inviteForm.message = ''
            showInviteModal.value = false
          }
        }

        const acceptInvite = (code) => {
          const invite = pendingInvitations.value.find(i => i.code === code)
          if (invite) {
            friends.value.push({
              username: invite.from,
              addedAt: Date.now(),
              mutualTasks: []
            })
            pendingInvitations.value = pendingInvitations.value.filter(i => i.code !== code)
          }
        }

        const declineInvite = (code) => {
          pendingInvitations.value = pendingInvitations.value.filter(i => i.code !== code)
        }

        const removeFriend = (username) => {
          friends.value = friends.value.filter(f => f.username !== username)
        }

        const resendInvite = (id) => {
          const invite = sentInvitations.value.find(i => i.id === id)
          if (invite) {
            invite.expiresAt = Date.now() + 7 * 24 * 60 * 60 * 1000
          }
        }

        const cancelInvite = (id) => {
          sentInvitations.value = sentInvitations.value.filter(i => i.id !== id)
        }

        const createTask = () => {
          if (taskForm.title) {
            tasks.value.push({
              id: `task-${Date.now()}`,
              title: taskForm.title,
              description: taskForm.description,
              status: 'pending',
              isShared: false
            })
            taskForm.title = ''
            taskForm.description = ''
            showTaskModal.value = false
          }
        }

        const shareTaskWithFriends = (task) => {
          task.isShared = !task.isShared
          if (task.isShared) {
            // å‰µå»ºå”ä½œæˆ–å…±äº«
            console.log('ä»»å‹™å·²å…±äº«:', task.title)
          }
        }

        const addCommentToCollab = (collabId) => {
          const collab = userCollaborations.value.find(c => c.id === collabId)
          if (collab && newComment[collabId]) {
            collab.comments.push({
              id: `comment-${Date.now()}`,
              author: currentUser.value,
              content: newComment[collabId]
            })
            newComment[collabId] = ''
          }
        }

        const exportData = () => {
          const data = {
            user: currentUser.value,
            friends: friends.value,
            tasks: tasks.value,
            collaborations: userCollaborations.value
          }
          const json = JSON.stringify(data, null, 2)
          const blob = new Blob([json], { type: 'application/json' })
          const url = URL.createObjectURL(blob)
          const a = document.createElement('a')
          a.href = url
          a.download = `${currentUser.value}-data.json`
          a.click()
        }

        const clearData = () => {
          if (confirm('ç¢ºèªæ¸…é™¤æ‰€æœ‰æ•¸æ“šï¼Ÿ')) {
            friends.value = []
            tasks.value = []
            pendingInvitations.value = []
            sentInvitations.value = []
            userCollaborations.value = []
          }
        }

        const formatDate = (timestamp) => {
          return new Date(timestamp).toLocaleDateString('zh-Hant')
        }

        return {
          currentUser,
          activeTab,
          showRegister,
          showInviteModal,
          showTaskModal,
          taskSearch,
          taskFilter,
          authForm,
          inviteForm,
          taskForm,
          newComment,
          friends,
          tasks,
          pendingInvitations,
          sentInvitations,
          userCollaborations,
          settings,
          tabs,
          userStats,
          filteredTasks,
          recentCollaborations,
          login,
          register,
          quickLogin,
          logout,
          inviteFriend,
          acceptInvite,
          declineInvite,
          removeFriend,
          resendInvite,
          cancelInvite,
          createTask,
          shareTaskWithFriends,
          addCommentToCollab,
          exportData,
          clearData,
          formatDate
        }
      }
    }).mount('#app')
  </script>
</body>
</html>
