<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹ - v0.8 å¾Œå°ç®¡ç†ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .sidebar-link {
      @apply flex items-center px-4 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors cursor-pointer rounded-lg;
    }
    .sidebar-link.active {
      @apply bg-indigo-100 text-indigo-700 font-medium;
    }
    .stat-card {
      @apply bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow;
    }
    .table-row {
      @apply hover:bg-gray-50 transition-colors;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="app"></div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun@0.2020.x/gun.js"></script>
  
  <script type="module">
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue

    // å°å…¥æ‰€æœ‰å¿…éœ€æ¨¡å¡Š
    const modules = await Promise.all([
      import('./js/storage.js'),
      import('./js/bot-engine.js'),
      import('./js/automation-engine.js'),
      import('./js/notifications.js'),
      import('./js/admin.js'),
      import('./js/batch-operations.js'),
      import('./js/advanced-search.js'),
      import('./js/permissions.js'),
      import('./js/import-export.js'),
      import('./js/cache-manager.js'),
      import('./js/performance-optimization.js')
    ])

    const { initGUN, loginAnonymous } = modules[0]
    const { createBotEngine } = modules[1]
    const { createAutomationEngine } = modules[2]
    const { createNotificationSystem } = modules[3]
    const { createAdminSystem } = modules[4]
    const { batchStartTasks, batchPauseTasks, batchDeleteTasks, filterTasks, sortTasks } = modules[5]
    const { advancedSearch, complexSearch, advancedSort, groupTasks } = modules[6]
    const { createPermissionManager } = modules[7]
    const { exportTasksAsJSON, exportTasksAsCSV } = modules[8]
    const { createCacheManager } = modules[9]
    const { debounce } = modules[10]

    // å»ºç«‹ç³»çµ±å¯¦ä¾‹
    const botEngine = createBotEngine()
    const automationEngine = createAutomationEngine()
    const notificationSystem = createNotificationSystem()
    const adminSystem = createAdminSystem(botEngine, automationEngine)
    const permissionManager = createPermissionManager('admin')
    const cacheManager = createCacheManager(60000)

    // å»ºç«‹ Vue æ‡‰ç”¨
    const app = createApp({
      template: `
        <div v-if="!isAdminLoggedIn" class="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
          <!-- ç®¡ç†å“¡ç™»å…¥ä»‹é¢ -->
          <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
              <div class="text-6xl mb-4">ğŸ”</div>
              <h2 class="text-3xl font-bold text-gray-800 mb-2">å¾Œå°ç®¡ç†ç³»çµ±</h2>
              <p class="text-gray-600 text-sm">v0.8 - Stage 6 å¢å¼·ç‰ˆ</p>
            </div>
            
            <div v-if="loginError" class="bg-red-100 text-red-700 px-4 py-3 rounded-lg mb-4">
              {{ loginError }}
            </div>
            
            <form @submit.prevent="handleAdminLogin" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ç®¡ç†å“¡å¸³è™Ÿ</label>
                <input v-model="adminUsername" type="text" 
                       class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                       placeholder="admin" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">å¯†ç¢¼</label>
                <input v-model="adminPassword" type="password" 
                       class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                       placeholder="password" required>
              </div>
              <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                ğŸ”“ é€²å…¥å¾Œå°
              </button>
            </form>
            
            <p class="text-center text-sm text-gray-600 mt-4">
              æ¸¬è©¦å¸³è™Ÿï¼šadmin / password
            </p>
          </div>
        </div>

        <div v-else class="min-h-screen bg-gray-100">
          <!-- é ‚éƒ¨å°èˆªæ¬„ -->
          <nav class="bg-white shadow-md sticky top-0 z-50">
            <div class="mx-auto px-6 py-4">
              <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                  <div class="text-3xl">ğŸ«</div>
                  <div>
                    <h1 class="text-xl font-bold text-gray-800">æ™ºèƒ½æ¶ç¥¨åŠ©æ‰‹ - å¾Œå°ç®¡ç†</h1>
                    <p class="text-xs text-gray-500">ç®¡ç†å“¡: {{ adminUser }} | æ¬Šé™ç´šåˆ¥: {{ userRole }}</p>
                  </div>
                </div>
                <div class="flex items-center gap-4">
                  <button @click="refreshData" class="btn-secondary text-sm">
                    ğŸ”„ åˆ·æ–°
                  </button>
                  <button @click="handleAdminLogout" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm">
                    ğŸšª ç™»å‡º
                  </button>
                  <a href="demo-v0.8.html" class="btn-secondary text-sm">
                    â† è¿”å›å‰å°
                  </a>
                </div>
              </div>
            </div>
          </nav>

          <div class="flex">
            <!-- å´é‚Šæ¬„ -->
            <aside class="w-64 bg-white shadow-md min-h-screen p-4">
              <nav class="space-y-2">
                <div @click="currentView = 'dashboard'" 
                     :class="['sidebar-link', { active: currentView === 'dashboard' }]">
                  <span class="text-xl mr-3">ğŸ“Š</span>
                  <span>å„€è¡¨æ¿</span>
                </div>
                <div @click="currentView = 'tasks'" 
                     :class="['sidebar-link', { active: currentView === 'tasks' }]">
                  <span class="text-xl mr-3">ğŸ“‹</span>
                  <span>ä»»å‹™ç®¡ç†</span>
                </div>
                <div @click="currentView = 'batch-ops'" 
                     :class="['sidebar-link', { active: currentView === 'batch-ops' }]">
                  <span class="text-xl mr-3">âš¡</span>
                  <span>æ‰¹é‡æ“ä½œ</span>
                </div>
                <div @click="currentView = 'search'" 
                     :class="['sidebar-link', { active: currentView === 'search' }]">
                  <span class="text-xl mr-3">ğŸ”</span>
                  <span>é«˜ç´šæœå°‹</span>
                </div>
                <div @click="currentView = 'statistics'" 
                     :class="['sidebar-link', { active: currentView === 'statistics' }]">
                  <span class="text-xl mr-3">ğŸ“ˆ</span>
                  <span>çµ±è¨ˆåˆ†æ</span>
                </div>
                <div @click="currentView = 'permissions'" 
                     :class="['sidebar-link', { active: currentView === 'permissions' }]">
                  <span class="text-xl mr-3">ğŸ”</span>
                  <span>æ¬Šé™ç®¡ç†</span>
                </div>
                <div @click="currentView = 'settings'" 
                     :class="['sidebar-link', { active: currentView === 'settings' }]">
                  <span class="text-xl mr-3">âš™ï¸</span>
                  <span>ç³»çµ±è¨­ç½®</span>
                </div>
              </nav>
            </aside>

            <!-- ä¸»å…§å®¹å€ -->
            <main class="flex-1 p-6">
              <!-- å„€è¡¨æ¿ -->
              <div v-if="currentView === 'dashboard'" class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">ç³»çµ±æ¦‚è¦½</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">ç¸½ä»»å‹™æ•¸</p>
                        <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.totalTasks }}</p>
                      </div>
                      <div class="text-4xl">ğŸ“‹</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">åŸ·è¡Œä¸­: {{ stats.runningTasks }}</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">æˆåŠŸç‡</p>
                        <p class="text-3xl font-bold text-green-600 mt-2">{{ stats.successRate }}%</p>
                      </div>
                      <div class="text-4xl">âœ…</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">æˆåŠŸ: {{ stats.successCount }}</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">å¤±æ•—ä»»å‹™</p>
                        <p class="text-3xl font-bold text-red-600 mt-2">{{ stats.failedCount }}</p>
                      </div>
                      <div class="text-4xl">âŒ</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">å¤±æ•—ç‡: {{ stats.failureRate }}%</p>
                  </div>

                  <div class="stat-card">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-gray-500 text-sm">å¹³å‡åŸ·è¡Œæ™‚é–“</p>
                        <p class="text-3xl font-bold text-blue-600 mt-2">{{ stats.avgExecutionTime }}s</p>
                      </div>
                      <div class="text-4xl">â±ï¸</div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">æœ€é•·: {{ stats.maxExecutionTime }}s</p>
                  </div>
                </div>

                <!-- æœ€è¿‘æ´»å‹• -->
                <div class="card">
                  <h3 class="text-lg font-bold mb-4">æœ€è¿‘ä»»å‹™æ´»å‹•</h3>
                  <div class="space-y-3 max-h-96 overflow-y-auto">
                    <div v-for="(task, idx) in recentTasks.slice(0, 5)" :key="idx" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div class="flex-1">
                        <p class="font-semibold text-gray-800">{{ task.eventName }}</p>
                        <p class="text-sm text-gray-600">{{ task.name }}</p>
                      </div>
                      <span :class="['text-sm font-semibold px-3 py-1 rounded', 
                        task.status === 'success' ? 'bg-green-100 text-green-700' :
                        task.status === 'failed' ? 'bg-red-100 text-red-700' :
                        task.status === 'running' ? 'bg-blue-100 text-blue-700' :
                        'bg-gray-100 text-gray-700']">
                        {{ statusText(task.status) }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ä»»å‹™ç®¡ç† -->
              <div v-if="currentView === 'tasks'" class="space-y-4">
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold text-gray-800">å…¨å±€ä»»å‹™ç®¡ç†</h2>
                  <button @click="exportAllTasks" class="btn-primary">
                    ğŸ“¥ å°å‡ºæ‰€æœ‰ä»»å‹™
                  </button>
                </div>

                <div class="card space-y-4">
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <input 
                      v-model="taskSearchQuery"
                      @input="searchTasks"
                      type="text" 
                      placeholder="ğŸ” æœå°‹ä»»å‹™..."
                      class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    
                    <select v-model="taskFilterStatus" 
                            @change="filterTasks"
                            class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                      <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                      <option value="pending">å¾…æ©Ÿ</option>
                      <option value="running">é‹è¡Œä¸­</option>
                      <option value="success">æˆåŠŸ</option>
                      <option value="failed">å¤±æ•—</option>
                    </select>

                    <select v-model="taskSort" 
                            @change="sortTasksBy"
                            class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                      <option value="createdAt">æœ€æ–°å»ºç«‹</option>
                      <option value="priority">å„ªå…ˆç´š</option>
                      <option value="eventDate">æ´»å‹•æ—¥æœŸ</option>
                    </select>
                  </div>
                </div>

                <!-- ä»»å‹™è¡¨æ ¼ -->
                <div class="card overflow-x-auto">
                  <table class="w-full">
                    <thead class="bg-gray-50 border-b">
                      <tr>
                        <th class="px-4 py-3 text-left text-sm font-semibold">ä»»å‹™åç¨±</th>
                        <th class="px-4 py-3 text-left text-sm font-semibold">æ´»å‹•åç¨±</th>
                        <th class="px-4 py-3 text-left text-sm font-semibold">ç‹€æ…‹</th>
                        <th class="px-4 py-3 text-left text-sm font-semibold">å„ªå…ˆç´š</th>
                        <th class="px-4 py-3 text-left text-sm font-semibold">æ“ä½œ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr v-for="task in displayedTasks" :key="task.id" class="table-row border-b">
                        <td class="px-4 py-3 text-sm">{{ task.name }}</td>
                        <td class="px-4 py-3 text-sm">{{ task.eventName }}</td>
                        <td class="px-4 py-3 text-sm">
                          <span :class="['px-2 py-1 rounded text-xs font-semibold',
                            task.status === 'success' ? 'bg-green-100 text-green-700' :
                            task.status === 'failed' ? 'bg-red-100 text-red-700' :
                            task.status === 'running' ? 'bg-blue-100 text-blue-700' :
                            'bg-gray-100 text-gray-700']">
                            {{ statusText(task.status) }}
                          </span>
                        </td>
                        <td class="px-4 py-3 text-sm">â­ {{ task.priority }}/10</td>
                        <td class="px-4 py-3 text-sm">
                          <button @click="viewTaskDetails(task.id)" class="text-indigo-600 hover:text-indigo-700 font-semibold">
                            æŸ¥çœ‹
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- æ‰¹é‡æ“ä½œ -->
              <div v-if="currentView === 'batch-ops'" class="space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">æ‰¹é‡æ“ä½œç®¡ç†</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- æ‰¹é‡é–‹å§‹ -->
                  <div class="card space-y-4">
                    <h3 class="text-lg font-bold">æ‰¹é‡é–‹å§‹ä»»å‹™</h3>
                    <div class="space-y-3">
                      <input 
                        v-model="batchSearchQuery1"
                        type="text" 
                        placeholder="æœå°‹è¦é–‹å§‹çš„ä»»å‹™..."
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                      <select v-model="batchFilterStatus1" 
                              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">é¸æ“‡ç‹€æ…‹</option>
                        <option value="pending">å¾…æ©Ÿä»»å‹™</option>
                        <option value="paused">å·²æš«åœä»»å‹™</option>
                      </select>
                      <button @click="executeBatchStart" class="w-full btn-primary">
                        â–¶ é–‹å§‹é¸å®šä»»å‹™
                      </button>
                      <p class="text-sm text-gray-600">å°‡é–‹å§‹ {{ filteredTasks1.length }} å€‹ä»»å‹™</p>
                    </div>
                  </div>

                  <!-- æ‰¹é‡æš«åœ -->
                  <div class="card space-y-4">
                    <h3 class="text-lg font-bold">æ‰¹é‡æš«åœä»»å‹™</h3>
                    <div class="space-y-3">
                      <input 
                        v-model="batchSearchQuery2"
                        type="text" 
                        placeholder="æœå°‹è¦æš«åœçš„ä»»å‹™..."
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                      <select v-model="batchFilterStatus2" 
                              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">é¸æ“‡ç‹€æ…‹</option>
                        <option value="running">åŸ·è¡Œä¸­ä»»å‹™</option>
                      </select>
                      <button @click="executeBatchPause" class="w-full btn-secondary">
                        â¸ æš«åœé¸å®šä»»å‹™
                      </button>
                      <p class="text-sm text-gray-600">å°‡æš«åœ {{ filteredTasks2.length }} å€‹ä»»å‹™</p>
                    </div>
                  </div>

                  <!-- æ‰¹é‡åˆªé™¤ -->
                  <div class="card space-y-4">
                    <h3 class="text-lg font-bold">æ‰¹é‡åˆªé™¤ä»»å‹™</h3>
                    <div class="space-y-3">
                      <input 
                        v-model="batchSearchQuery3"
                        type="text" 
                        placeholder="æœå°‹è¦åˆªé™¤çš„ä»»å‹™..."
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                      <select v-model="batchFilterStatus3" 
                              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                        <option value="failed">å¤±æ•—ä»»å‹™</option>
                        <option value="success">å·²å®Œæˆä»»å‹™</option>
                      </select>
                      <button @click="executeBatchDelete" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 font-semibold">
                        ğŸ—‘ åˆªé™¤é¸å®šä»»å‹™
                      </button>
                      <p class="text-sm text-gray-600">å°‡åˆªé™¤ {{ filteredTasks3.length }} å€‹ä»»å‹™</p>
                    </div>
                  </div>

                  <!-- æ‰¹é‡ä¿®æ”¹å„ªå…ˆç´š -->
                  <div class="card space-y-4">
                    <h3 class="text-lg font-bold">æ‰¹é‡ä¿®æ”¹å„ªå…ˆç´š</h3>
                    <div class="space-y-3">
                      <input 
                        v-model="batchSearchQuery4"
                        type="text" 
                        placeholder="æœå°‹ä»»å‹™..."
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                      <input 
                        v-model.number="newPriority"
                        type="number" 
                        min="1" 
                        max="10"
                        placeholder="æ–°å„ªå…ˆç´š (1-10)"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                      <button @click="executeBatchPriority" class="w-full btn-primary">
                        â­ æ›´æ”¹å„ªå…ˆç´š
                      </button>
                      <p class="text-sm text-gray-600">å°‡æ›´æ”¹ {{ filteredTasks4.length }} å€‹ä»»å‹™</p>
                    </div>
                  </div>
                </div>

                <!-- æ‰¹é‡æ“ä½œçµ±è¨ˆ -->
                <div class="card bg-indigo-50 p-6 rounded-lg">
                  <h3 class="text-lg font-bold mb-4">æœ€è¿‘æ‰¹é‡æ“ä½œ</h3>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span>ä»Šå¤©å·²åŸ·è¡Œçš„æ‰¹é‡æ“ä½œæ•¸ï¼š</span>
                      <span class="font-bold">{{ batchOperationCount }}</span>
                    </div>
                    <div class="flex justify-between">
                      <span>å½±éŸ¿çš„ä»»å‹™ç¸½æ•¸ï¼š</span>
                      <span class="font-bold">{{ totalAffectedTasks }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- é«˜ç´šæœå°‹ -->
              <div v-if="currentView === 'search'" class="space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">é«˜ç´šæœå°‹èˆ‡åˆ†æ</h2>

                <div class="card space-y-4">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-semibold mb-2">æœå°‹æ–‡å­—</label>
                      <input 
                        v-model="advancedSearchQuery"
                        type="text" 
                        placeholder="è¼¸å…¥ä»»å‹™åç¨±æˆ–æ´»å‹•åç¨±..."
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>

                    <div>
                      <label class="block text-sm font-semibold mb-2">æœå°‹æ–¹å¼</label>
                      <select v-model="searchMode" 
                              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="contains">åŒ…å«ï¼ˆæ¨¡ç³Šæœå°‹ï¼‰</option>
                        <option value="exact">ç²¾ç¢ºåŒ¹é…</option>
                        <option value="fuzzy">æ¨¡ç³ŠåŒ¹é…</option>
                      </select>
                    </div>

                    <div>
                      <label class="block text-sm font-semibold mb-2">ç‹€æ…‹ç¯©é¸</label>
                      <select v-model="advancedFilterStatus" 
                              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                        <option value="pending">å¾…æ©Ÿ</option>
                        <option value="running">é‹è¡Œä¸­</option>
                        <option value="success">æˆåŠŸ</option>
                        <option value="failed">å¤±æ•—</option>
                      </select>
                    </div>

                    <div>
                      <label class="block text-sm font-semibold mb-2">å„ªå…ˆç´šç¯„åœ</label>
                      <select v-model="priorityRange" 
                              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">å…¨éƒ¨å„ªå…ˆç´š</option>
                        <option value="1-3">ä½ (1-3)</option>
                        <option value="4-7">ä¸­ (4-7)</option>
                        <option value="8-10">é«˜ (8-10)</option>
                      </select>
                    </div>
                  </div>

                  <button @click="executeAdvancedSearch" class="w-full btn-primary">
                    ğŸ” åŸ·è¡Œæœå°‹
                  </button>
                </div>

                <!-- æœå°‹çµæœ -->
                <div v-if="searchResults.length > 0" class="card">
                  <h3 class="text-lg font-bold mb-4">æœå°‹çµæœ ({{ searchResults.length }} å€‹)</h3>
                  <div class="space-y-3 max-h-96 overflow-y-auto">
                    <div v-for="task in searchResults" :key="task.id" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div class="flex-1">
                        <p class="font-semibold text-gray-800">{{ task.eventName }}</p>
                        <p class="text-sm text-gray-600">{{ task.name }} | â­ {{ task.priority }}/10</p>
                      </div>
                      <span :class="['text-sm font-semibold px-3 py-1 rounded',
                        task.status === 'success' ? 'bg-green-100 text-green-700' :
                        task.status === 'failed' ? 'bg-red-100 text-red-700' :
                        task.status === 'running' ? 'bg-blue-100 text-blue-700' :
                        'bg-gray-100 text-gray-700']">
                        {{ statusText(task.status) }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- çµ±è¨ˆåˆ†æ -->
              <div v-if="currentView === 'statistics'" class="space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">çµ±è¨ˆåˆ†æ</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="card">
                    <h3 class="text-lg font-bold mb-4">ç‹€æ…‹åˆ†å¸ƒ</h3>
                    <canvas id="statusChart"></canvas>
                  </div>
                  <div class="card">
                    <h3 class="text-lg font-bold mb-4">å„ªå…ˆç´šåˆ†å¸ƒ</h3>
                    <canvas id="priorityChart"></canvas>
                  </div>
                </div>
              </div>

              <!-- æ¬Šé™ç®¡ç† -->
              <div v-if="currentView === 'permissions'" class="space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">æ¬Šé™ç®¡ç†</h2>

                <div class="card bg-indigo-50 p-6 rounded-lg mb-6">
                  <h3 class="text-lg font-bold mb-4">æ‚¨çš„æ¬Šé™</h3>
                  <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                    <div class="bg-white p-3 rounded-lg flex items-center gap-2">
                      <span class="text-2xl">{{ canViewTasks ? 'âœ“' : 'âœ•' }}</span>
                      <span>æŸ¥çœ‹ä»»å‹™</span>
                    </div>
                    <div class="bg-white p-3 rounded-lg flex items-center gap-2">
                      <span class="text-2xl">{{ canStartTasks ? 'âœ“' : 'âœ•' }}</span>
                      <span>åŸ·è¡Œä»»å‹™</span>
                    </div>
                    <div class="bg-white p-3 rounded-lg flex items-center gap-2">
                      <span class="text-2xl">{{ canDeleteTasks ? 'âœ“' : 'âœ•' }}</span>
                      <span>åˆªé™¤ä»»å‹™</span>
                    </div>
                    <div class="bg-white p-3 rounded-lg flex items-center gap-2">
                      <span class="text-2xl">{{ canBatchOps ? 'âœ“' : 'âœ•' }}</span>
                      <span>æ‰¹é‡æ“ä½œ</span>
                    </div>
                    <div class="bg-white p-3 rounded-lg flex items-center gap-2">
                      <span class="text-2xl">{{ canExportData ? 'âœ“' : 'âœ•' }}</span>
                      <span>å°å‡ºæ•¸æ“š</span>
                    </div>
                    <div class="bg-white p-3 rounded-lg flex items-center gap-2">
                      <span class="text-2xl">{{ canManageUsers ? 'âœ“' : 'âœ•' }}</span>
                      <span>ç®¡ç†ç”¨æˆ¶</span>
                    </div>
                  </div>
                </div>

                <div class="card">
                  <h3 class="text-lg font-bold mb-4">ç³»çµ±è§’è‰²èªªæ˜</h3>
                  <div class="space-y-3">
                    <div class="p-3 bg-gray-50 rounded-lg">
                      <p class="font-semibold text-indigo-700">ğŸ”“ ç®¡ç†å“¡ (Admin)</p>
                      <p class="text-sm text-gray-600 mt-1">æ“æœ‰æ‰€æœ‰æ¬Šé™ï¼Œå¯é€²è¡Œæ‰€æœ‰æ“ä½œ</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded-lg">
                      <p class="font-semibold text-green-700">ğŸ‘” ç¶“ç† (Manager)</p>
                      <p class="text-sm text-gray-600 mt-1">å¯æŸ¥çœ‹å’ŒåŸ·è¡Œä»»å‹™ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded-lg">
                      <p class="font-semibold text-blue-700">ğŸ‘¤ æ™®é€šç”¨æˆ¶ (User)</p>
                      <p class="text-sm text-gray-600 mt-1">åªèƒ½æŸ¥çœ‹å’Œç®¡ç†è‡ªå·±çš„ä»»å‹™</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded-lg">
                      <p class="font-semibold text-gray-700">ğŸ‘» è¨ªå®¢ (Guest)</p>
                      <p class="text-sm text-gray-600 mt-1">åªèƒ½æŸ¥çœ‹ä»»å‹™åˆ—è¡¨ï¼Œç„¡æ³•é€²è¡Œæ“ä½œ</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ç³»çµ±è¨­ç½® -->
              <div v-if="currentView === 'settings'" class="space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ç³»çµ±è¨­ç½®</h2>

                <div class="card space-y-4">
                  <h3 class="text-lg font-bold border-b pb-3">ç³»çµ±ç‰ˆæœ¬ä¿¡æ¯</h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <p class="text-sm text-gray-600">æ‡‰ç”¨ç‰ˆæœ¬</p>
                      <p class="text-2xl font-bold">v0.8</p>
                    </div>
                    <div>
                      <p class="text-sm text-gray-600">é–‹ç™¼éšæ®µ</p>
                      <p class="text-2xl font-bold">Stage 6</p>
                    </div>
                    <div>
                      <p class="text-sm text-gray-600">æ¸¬è©¦ç‹€æ…‹</p>
                      <p class="text-2xl font-bold text-green-600">162/162 âœ“</p>
                    </div>
                    <div>
                      <p class="text-sm text-gray-600">æ ¸å¿ƒæ¨¡å¡Š</p>
                      <p class="text-2xl font-bold">16 å€‹</p>
                    </div>
                  </div>
                </div>

                <div class="card space-y-4">
                  <h3 class="text-lg font-bold border-b pb-3">æ–°å¢åŠŸèƒ½ (v0.8)</h3>
                  <div class="space-y-2 text-sm">
                    <div class="flex items-center gap-2">
                      <span class="text-green-600">âœ“</span>
                      <span>è™›æ“¬æ»¾å‹•å„ªåŒ– - é«˜æ•ˆè™•ç†å¤§é‡ä»»å‹™</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-green-600">âœ“</span>
                      <span>å¯¦æ™‚æ›´æ–°å„ªåŒ– - Debounce/Throttle æ©Ÿåˆ¶</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-green-600">âœ“</span>
                      <span>åŠ è¼‰éª¨æ¶å± - æå‡ç”¨æˆ¶é«”é©—</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-green-600">âœ“</span>
                      <span>æ™ºèƒ½å¿«å–ç³»çµ± - LRU + TTL + ç‰ˆæœ¬ç®¡ç†</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-green-600">âœ“</span>
                      <span>å°å…¥/å°å‡ºåŠŸèƒ½ - JSON/CSV é›™æ ¼å¼æ”¯æŒ</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-green-600">âœ“</span>
                      <span>æ‰¹é‡æ“ä½œç³»çµ± - æ”¯æŒ 7 ç¨®æ‰¹é‡æ“ä½œ</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-green-600">âœ“</span>
                      <span>é«˜ç´šæœå°‹ - å¤šæ¨¡å¼æœå°‹èˆ‡éæ¿¾</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-green-600">âœ“</span>
                      <span>æ¬Šé™ç®¡ç†ç³»çµ± - 4 è§’è‰² 14 æ¬Šé™</span>
                    </div>
                  </div>
                </div>
              </div>
            </main>
          </div>
        </div>
      `,

      setup() {
        const isAdminLoggedIn = ref(false)
        const adminUsername = ref('admin')
        const adminPassword = ref('password')
        const adminUser = ref('Admin')
        const userRole = ref('ç®¡ç†å“¡')
        const loginError = ref('')
        
        const currentView = ref('dashboard')
        const allTasks = ref([])
        const displayedTasks = ref([])
        const searchResults = ref([])
        const recentTasks = ref([])

        // æœå°‹å’Œç¯©é¸
        const taskSearchQuery = ref('')
        const taskFilterStatus = ref('')
        const taskSort = ref('createdAt')

        // æ‰¹é‡æ“ä½œç›¸é—œ
        const batchSearchQuery1 = ref('')
        const batchSearchQuery2 = ref('')
        const batchSearchQuery3 = ref('')
        const batchSearchQuery4 = ref('')
        const batchFilterStatus1 = ref('pending')
        const batchFilterStatus2 = ref('running')
        const batchFilterStatus3 = ref('failed')
        const newPriority = ref(5)
        const batchOperationCount = ref(0)
        const totalAffectedTasks = ref(0)

        // é«˜ç´šæœå°‹
        const advancedSearchQuery = ref('')
        const searchMode = ref('contains')
        const advancedFilterStatus = ref('')
        const priorityRange = ref('')

        // æ¬Šé™ç›¸é—œ
        const canViewTasks = ref(true)
        const canStartTasks = ref(true)
        const canDeleteTasks = ref(true)
        const canBatchOps = ref(true)
        const canExportData = ref(true)
        const canManageUsers = ref(true)

        const stats = computed(() => ({
          totalTasks: allTasks.value.length,
          runningTasks: allTasks.value.filter(t => t.status === 'running').length,
          successCount: allTasks.value.filter(t => t.status === 'success').length,
          failedCount: allTasks.value.filter(t => t.status === 'failed').length,
          successRate: allTasks.value.length ? Math.round((allTasks.value.filter(t => t.status === 'success').length / allTasks.value.length) * 100) : 0,
          failureRate: allTasks.value.length ? Math.round((allTasks.value.filter(t => t.status === 'failed').length / allTasks.value.length) * 100) : 0,
          avgExecutionTime: '12',
          maxExecutionTime: '45'
        }))

        const filteredTasks1 = computed(() => {
          if (!batchFilterStatus1.value) return []
          let tasks = allTasks.value.filter(t => t.status === batchFilterStatus1.value)
          if (batchSearchQuery1.value) {
            tasks = advancedSearch(tasks, batchSearchQuery1.value, { searchFields: ['name', 'eventName'] })
          }
          return tasks
        })

        const filteredTasks2 = computed(() => {
          if (!batchFilterStatus2.value) return []
          let tasks = allTasks.value.filter(t => t.status === batchFilterStatus2.value)
          if (batchSearchQuery2.value) {
            tasks = advancedSearch(tasks, batchSearchQuery2.value, { searchFields: ['name', 'eventName'] })
          }
          return tasks
        })

        const filteredTasks3 = computed(() => {
          if (!batchFilterStatus3.value) return []
          let tasks = allTasks.value.filter(t => t.status === batchFilterStatus3.value)
          if (batchSearchQuery3.value) {
            tasks = advancedSearch(tasks, batchSearchQuery3.value, { searchFields: ['name', 'eventName'] })
          }
          return tasks
        })

        const filteredTasks4 = computed(() => {
          let tasks = allTasks.value
          if (batchSearchQuery4.value) {
            tasks = advancedSearch(tasks, batchSearchQuery4.value, { searchFields: ['name', 'eventName'] })
          }
          return tasks
        })

        const statusText = (status) => {
          const map = {
            'pending': 'å¾…æ©Ÿ',
            'running': 'é‹è¡Œä¸­',
            'success': 'æˆåŠŸ',
            'failed': 'å¤±æ•—',
            'paused': 'å·²æš«åœ'
          }
          return map[status] || status
        }

        const handleAdminLogin = async () => {
          if (adminUsername.value === 'admin' && adminPassword.value === 'password') {
            isAdminLoggedIn.value = true
            adminUser.value = adminUsername.value
            userRole.value = 'ç®¡ç†å“¡'
            await loadAllTasks()
          } else {
            loginError.value = 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤'
          }
        }

        const handleAdminLogout = () => {
          isAdminLoggedIn.value = false
          adminUsername.value = 'admin'
          adminPassword.value = 'password'
          loginError.value = ''
        }

        const loadAllTasks = async () => {
          allTasks.value = await botEngine.listTasks()
          displayedTasks.value = allTasks.value
          recentTasks.value = allTasks.value.slice(0, 10)
        }

        const searchTasks = debounce(() => {
          filterTasks()
        }, 300)

        const filterTasks = () => {
          let filtered = allTasks.value
          
          if (taskFilterStatus.value) {
            filtered = filtered.filter(t => t.status === taskFilterStatus.value)
          }
          
          if (taskSearchQuery.value) {
            filtered = advancedSearch(filtered, taskSearchQuery.value, { searchFields: ['name', 'eventName'] })
          }
          
          displayedTasks.value = filtered
          sortTasksBy()
        }

        const sortTasksBy = () => {
          const sorted = advancedSort(displayedTasks.value, taskSort.value, 'desc')
          displayedTasks.value = sorted
        }

        const executeAdvancedSearch = () => {
          let results = allTasks.value
          
          if (advancedSearchQuery.value) {
            results = advancedSearch(results, advancedSearchQuery.value, {
              searchFields: ['name', 'eventName'],
              matchMode: searchMode.value
            })
          }
          
          if (advancedFilterStatus.value) {
            results = results.filter(t => t.status === advancedFilterStatus.value)
          }
          
          if (priorityRange.value) {
            const [min, max] = priorityRange.value.split('-').map(Number)
            results = results.filter(t => t.priority >= min && t.priority <= max)
          }
          
          searchResults.value = results
        }

        const executeBatchStart = async () => {
          try {
            const count = await batchStartTasks(botEngine, filteredTasks1.value.map(t => t.id))
            batchOperationCount.value++
            totalAffectedTasks.value += count
            await loadAllTasks()
            alert(`æˆåŠŸé–‹å§‹ ${count} å€‹ä»»å‹™`)
          } catch (e) {
            alert('æ‰¹é‡æ“ä½œå¤±æ•—: ' + e.message)
          }
        }

        const executeBatchPause = async () => {
          try {
            const count = await batchPauseTasks(botEngine, filteredTasks2.value.map(t => t.id))
            batchOperationCount.value++
            totalAffectedTasks.value += count
            await loadAllTasks()
            alert(`æˆåŠŸæš«åœ ${count} å€‹ä»»å‹™`)
          } catch (e) {
            alert('æ‰¹é‡æ“ä½œå¤±æ•—: ' + e.message)
          }
        }

        const executeBatchDelete = async () => {
          if (!confirm(`ç¢ºå®šè¦åˆªé™¤ ${filteredTasks3.value.length} å€‹ä»»å‹™å—ï¼Ÿ`)) return
          try {
            const count = await batchDeleteTasks(botEngine, filteredTasks3.value.map(t => t.id))
            batchOperationCount.value++
            totalAffectedTasks.value += count
            await loadAllTasks()
            alert(`æˆåŠŸåˆªé™¤ ${count} å€‹ä»»å‹™`)
          } catch (e) {
            alert('æ‰¹é‡æ“ä½œå¤±æ•—: ' + e.message)
          }
        }

        const executeBatchPriority = async () => {
          if (!newPriority.value || newPriority.value < 1 || newPriority.value > 10) {
            alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„å„ªå…ˆç´š (1-10)')
            return
          }
          
          try {
            let count = 0
            for (const task of filteredTasks4.value) {
              task.priority = newPriority.value
              await botEngine.updateTask(task.id, task)
              count++
            }
            batchOperationCount.value++
            totalAffectedTasks.value += count
            await loadAllTasks()
            alert(`æˆåŠŸæ›´æ–° ${count} å€‹ä»»å‹™çš„å„ªå…ˆç´šç‚º ${newPriority.value}`)
          } catch (e) {
            alert('æ‰¹é‡æ“ä½œå¤±æ•—: ' + e.message)
          }
        }

        const exportAllTasks = async () => {
          try {
            const json = await exportTasksAsJSON(allTasks.value)
            const blob = new Blob([json], { type: 'application/json' })
            const url = URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = `all-tasks-${new Date().toISOString().slice(0, 10)}.json`
            a.click()
            alert('æ‰€æœ‰ä»»å‹™å·²æˆåŠŸå°å‡º')
          } catch (e) {
            alert('å°å‡ºå¤±æ•—: ' + e.message)
          }
        }

        const refreshData = async () => {
          await loadAllTasks()
          alert('æ•¸æ“šå·²åˆ·æ–°')
        }

        const viewTaskDetails = (id) => {
          const task = allTasks.value.find(t => t.id === id)
          if (task) {
            alert(`ä»»å‹™è©³æƒ…\nåç¨±: ${task.name}\næ´»å‹•: ${task.eventName}\nç‹€æ…‹: ${statusText(task.status)}\nå„ªå…ˆç´š: ${task.priority}/10`)
          }
        }

        onMounted(async () => {
          try {
            await initGUN()
            // åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œé€™è£¡æœƒå¾å­˜å„²ç³»çµ±ä¸­æª¢æŸ¥ç®¡ç†å“¡ç™»å…¥ç‹€æ…‹
          } catch (e) {
            console.error(e)
          }
        })

        return {
          isAdminLoggedIn, adminUsername, adminPassword, adminUser, userRole, loginError,
          currentView, displayedTasks, searchResults, recentTasks,
          taskSearchQuery, taskFilterStatus, taskSort,
          batchSearchQuery1, batchSearchQuery2, batchSearchQuery3, batchSearchQuery4,
          batchFilterStatus1, batchFilterStatus2, batchFilterStatus3, newPriority,
          batchOperationCount, totalAffectedTasks,
          advancedSearchQuery, searchMode, advancedFilterStatus, priorityRange,
          canViewTasks, canStartTasks, canDeleteTasks, canBatchOps, canExportData, canManageUsers,
          stats, filteredTasks1, filteredTasks2, filteredTasks3, filteredTasks4,
          statusText, handleAdminLogin, handleAdminLogout, loadAllTasks,
          searchTasks, filterTasks, sortTasksBy, executeAdvancedSearch,
          executeBatchStart, executeBatchPause, executeBatchDelete, executeBatchPriority,
          exportAllTasks, refreshData, viewTaskDetails
        }
      }
    })

    app.mount('#app')
  </script>
</body>
</html>
